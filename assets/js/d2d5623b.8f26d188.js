"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1251],{17079:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>n,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"server-admin/prometheus","title":"Prometheus","description":"Prometheus metrics are available at /erddap/metrics. JVM core metrics were added in 2.25 with many ERDDAP\u2122 metrics added in version 2.26. If you want to use the metrics make sure you are in at least version 2.26. They default to enabled, you can disable them by adding","source":"@site/docs/server-admin/prometheus.md","sourceDirName":"server-admin","slug":"/server-admin/prometheus","permalink":"/docs/server-admin/prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/erddap/erddap.github.io/tree/main/docs/server-admin/prometheus.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"docSidebar","previous":{"title":"Localized Metadata","permalink":"/docs/server-admin/localized-metadata"},"next":{"title":"Feature Flags","permalink":"/docs/server-admin/feature-flags"}}');var r=s(74848),i=s(28453);const n={sidebar_position:9},o="Prometheus",d={},l=[{value:"Running Prometheus server",id:"running-prometheus-server",level:2},{value:"ERDDAP\u2122 metrics",id:"erddap-metrics",level:2},{value:"JVM",id:"jvm",level:3},{value:"ERDDAP\u2122 specific",id:"erddap-specific",level:3},{value:"ERDDAP_build_info",id:"erddap_build_info",level:4},{value:"feature_flags",id:"feature_flags",level:4},{value:"bufferedImage",id:"bufferedimage",level:4},{value:"http_request_duration_seconds",id:"http_request_duration_seconds",level:4},{value:"touch_thread_duration_seconds",id:"touch_thread_duration_seconds",level:4},{value:"task_thread_duration_seconds",id:"task_thread_duration_seconds",level:4},{value:"load_datasets_duration_seconds",id:"load_datasets_duration_seconds",level:4},{value:"email_thread_duration_seconds",id:"email_thread_duration_seconds",level:4},{value:"email_count_distribution",id:"email_count_distribution",level:4},{value:"dataset_count",id:"dataset_count",level:4},{value:"dataset_failed_load_count",id:"dataset_failed_load_count",level:4},{value:"shed_requests_total",id:"shed_requests_total",level:4},{value:"dangerous_memory_emails_total",id:"dangerous_memory_emails_total",level:4},{value:"dangerous_memory_failures_total",id:"dangerous_memory_failures_total",level:4},{value:"topo_request_total",id:"topo_request_total",level:4},{value:"Boundary Counters",id:"boundary-counters",level:4}];function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"prometheus",children:"Prometheus"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://prometheus.io/",children:"Prometheus metrics"})," are available at /erddap/metrics. JVM core metrics were added in 2.25 with many ERDDAP\u2122 metrics added in version 2.26. If you want to use the metrics make sure you are in at least version 2.26. They default to enabled, you can disable them by adding"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-xml",children:"<usePrometheusMetrics>false</usePrometheusMetrics>\n"})}),"\n",(0,r.jsx)(t.p,{children:"to your setup.xml."}),"\n",(0,r.jsx)(t.p,{children:"These metrics are designed to be machine readable. While you can check the metrics page manually, for in depth monitoring it is recommended to use a Prometheus server. A Prometheus server will store historical metrics which enable more in depth monitoring (like rates and changes from past values), and also is often run with a Grafana server. We provide some prebuilt dashboards that admins may find useful for getting started monitoring their servers."}),"\n",(0,r.jsx)(t.h2,{id:"running-prometheus-server",children:"Running Prometheus server"}),"\n",(0,r.jsxs)(t.p,{children:["The best documentation for running the monitoring stack (Prometheus + Grafana) is in the Prometheus ",(0,r.jsx)(t.a,{href:"https://github.com/ERDDAP/erddap/blob/main/docker/prometheus/README.md",children:"readme"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"erddap-metrics",children:"ERDDAP\u2122 metrics"}),"\n",(0,r.jsx)(t.h3,{id:"jvm",children:"JVM"}),"\n",(0,r.jsxs)(t.p,{children:["ERDDAP\u2122 exports a number of metrics that you may find useful (starting in ERDDAP\u2122 2.25). For general monitoring of the health of the JVM we use the metrics collected by the Prometheus client. This includes data about garbage collection, memory usage, threads, and more. For more information see the ",(0,r.jsx)(t.a,{href:"https://prometheus.github.io/client_java/instrumentation/jvm/",children:"Prometheus Java Client JVM documentation"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"erddap-specific",children:"ERDDAP\u2122 specific"}),"\n",(0,r.jsxs)(t.p,{children:["We also export a number of ERDDAP\u2122 specific metrics (starting in ERDDAP\u2122 2.26). If you want to dig into the code, you can find the metrics collected in ",(0,r.jsx)(t.a,{href:"https://github.com/ERDDAP/erddap/blob/main/WEB-INF/classes/gov/noaa/pfel/erddap/util/Metrics.java",children:"Metrics.java"}),"."]}),"\n",(0,r.jsx)(t.h4,{id:"erddap_build_info",children:"ERDDAP_build_info"}),"\n",(0,r.jsx)(t.p,{children:"This is the build info for the ERDDAP\u2122 server. It includes version (major.minor), version_full (major.minor.patch), and deployment_info (used to indicate how the server is deployed, like 'Docker')."}),"\n",(0,r.jsx)(t.h4,{id:"feature_flags",children:"feature_flags"}),"\n",(0,r.jsx)(t.p,{children:"This is an info metric that shows the current state of feature flags. Most boolean configuration options are considered feature flags."}),"\n",(0,r.jsx)(t.h4,{id:"bufferedimage",children:"bufferedImage"}),"\n",(0,r.jsx)(t.p,{children:"This is an info metric that indicates whether graphics acceleration is available."}),"\n",(0,r.jsx)(t.h4,{id:"http_request_duration_seconds",children:"http_request_duration_seconds"}),"\n",(0,r.jsx)(t.p,{children:"This is a histogram of request response durations in seconds. The labels are request_type (for example griddap, tabledap, files, wms), dataset_id (if applicable, otherwise repeats the request type), file_type (output format for request e.g. '.html', '.csv', '.iso19115'), lang_code (language for the request, or empty string if default), status_code (http status code of the request e.g. 200, 302, 404)."}),"\n",(0,r.jsx)(t.p,{children:"This can be used to track requests by dataset id to determine the server's popular datasets. It can also help identify if there are particular kinds of requests that are slow on your server."}),"\n",(0,r.jsx)(t.h4,{id:"touch_thread_duration_seconds",children:"touch_thread_duration_seconds"}),"\n",(0,r.jsx)(t.p,{children:"A histogram of touch thread task durations. They are labelled with success (true/false)."}),"\n",(0,r.jsx)(t.h4,{id:"task_thread_duration_seconds",children:"task_thread_duration_seconds"}),"\n",(0,r.jsx)(t.p,{children:"A histogram of task thread durations. They are labelled with success (true/false) and task_type (intetger)."}),"\n",(0,r.jsx)(t.h4,{id:"load_datasets_duration_seconds",children:"load_datasets_duration_seconds"}),"\n",(0,r.jsx)(t.p,{children:"A histogram of duration for load dataset tasks. They are labelled with major (true/false)."}),"\n",(0,r.jsx)(t.h4,{id:"email_thread_duration_seconds",children:"email_thread_duration_seconds"}),"\n",(0,r.jsx)(t.p,{children:"A histogram of email thread task durations. They are labelled with success (true/false)."}),"\n",(0,r.jsx)(t.h4,{id:"email_count_distribution",children:"email_count_distribution"}),"\n",(0,r.jsx)(t.p,{children:"A histogram of emails per task."}),"\n",(0,r.jsx)(t.h4,{id:"dataset_count",children:"dataset_count"}),"\n",(0,r.jsx)(t.p,{children:"A gauge of the datasets, set after each load datasets call. This is labelled with category (grid, table)."}),"\n",(0,r.jsx)(t.h4,{id:"dataset_failed_load_count",children:"dataset_failed_load_count"}),"\n",(0,r.jsx)(t.p,{children:"A gauge of the datasets that failed to load, set after each load datasets call."}),"\n",(0,r.jsx)(t.h4,{id:"shed_requests_total",children:"shed_requests_total"}),"\n",(0,r.jsx)(t.p,{children:"Counter of requests that were shed. The server will shed a request when it believes the server is low on memory (RAM) and the request would cause problems. This does not include requests that error due to low RAM or disk space during the handling of the request."}),"\n",(0,r.jsx)(t.h4,{id:"dangerous_memory_emails_total",children:"dangerous_memory_emails_total"}),"\n",(0,r.jsx)(t.p,{children:"Counter of times the server attempts to send an email to the admin that memory is dangerously low."}),"\n",(0,r.jsx)(t.h4,{id:"dangerous_memory_failures_total",children:"dangerous_memory_failures_total"}),"\n",(0,r.jsx)(t.p,{children:"Counter of requests that failed due to the machine running out of memory. Often times this is because the machine is receiving a lot of expensive requests or the individual request was exceptionally large."}),"\n",(0,r.jsx)(t.h4,{id:"topo_request_total",children:"topo_request_total"}),"\n",(0,r.jsx)(t.p,{children:"Counter of requests for topo data. This is labelled cache (cached/not_cached)."}),"\n",(0,r.jsx)(t.h4,{id:"boundary-counters",children:"Boundary Counters"}),"\n",(0,r.jsx)(t.p,{children:"There's also a collection of counters for requests for boundaries:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"national_boundaries_request_total"}),"\n",(0,r.jsx)(t.li,{children:"state_boundaries_request_total"}),"\n",(0,r.jsx)(t.li,{children:"river_boundaries_request_total"}),"\n",(0,r.jsx)(t.li,{children:"gshhs_request_total"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"These are labelled with status (coarse, success, tossed)."})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>n,x:()=>o});var a=s(96540);const r={},i=a.createContext(r);function n(e){const t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:n(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);