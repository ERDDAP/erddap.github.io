"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1557],{28453(e,s,n){n.d(s,{R:()=>r,x:()=>i});var t=n(96540);const o={},a=t.createContext(o);function r(e){const s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(a.Provider,{value:s},e.children)}},78591(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"server-admin/admin-tips/swap-space","title":"swap-space","description":"This content is based on a message from Roy Mendelssohn to the ERDDAP users group.","source":"@site/docs/server-admin/admin-tips/swap-space.md","sourceDirName":"server-admin/admin-tips","slug":"/server-admin/admin-tips/swap-space","permalink":"/id/docs/server-admin/admin-tips/swap-space","draft":false,"unlisted":false,"editUrl":"https://github.com/erddap/erddap.github.io/tree/main/docs/server-admin/admin-tips/swap-space.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docSidebar","previous":{"title":"rclone-s3","permalink":"/id/docs/server-admin/admin-tips/rclone-s3"},"next":{"title":"Login","permalink":"/id/docs/server-admin/deploy-install"}}');var o=n(74848),a=n(28453);const r={},i=void 0,c={},l=[];function h(e){const s={a:"a",blockquote:"blockquote",p:"p",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(s.p,{children:["This content is based on a ",(0,o.jsx)(s.a,{href:"https://groups.google.com/g/erddap/c/1U0OByOasu4/m/JM39reEsBAAJ",children:"message from Roy Mendelssohn to the ERDDAP users group"}),"."]}),"\n",(0,o.jsx)(s.p,{children:"A lot of the help requests we get involve problems with memory usage in ERDDAP\u2122. Some of this comes from changes in memory management in Java, and also interactions with Linux OS memory management. Starting I believe in Java 17, Java uses more memory than what is put down in the heap settings. You can see this if you look at your heap settings and then use commands such as top, htop, or btop to check the memory usage of applications. So for example our heavily used ERDDAP\u2122 has heap space set at 21GB, but actually memory use can run to 28GB-30GB, sometimes higher. This value can spike if there is a lot of simultaneous large requests to the system."}),"\n",(0,o.jsx)(s.p,{children:"On most Linux systems, once memory usage gets above about 50%, the OS will start swapping out memory. Moreover, for most systems swap space is not garbage collected until absolutely necessary, which for ERDDAP\u2122 is too late, and can cause ERDDAP\u2122 to freeze. And swap space is slow, which for large datasets.xml can cause major updates not to complete, which then compound the problems."}),"\n",(0,o.jsx)(s.p,{children:"What can you do about this. First, find out the true memory usage or your system, and have enough RAM so that the memory usage does not exceed 50%. But there are also two settings that can change this behavior, vm.swappiness. and vm.vfs_cache_pressure."}),"\n",(0,o.jsx)(s.p,{children:"vm.swappiness controls how aggressively the Linux kernel uses swap space. You can check its current value with:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"cat /proc/sys/vm/swappiness"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"\u2022 Default is usually 60 (on a scale from 0 to 100).\n\u2022 Lower values make the system less likely to swap.\n\u2022 A value of 10 or 1 is often used for systems with plenty of RAM."}),"\n",(0,o.jsx)(s.p,{children:"To change the value until reboot, say to 10:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo sysctl vm.swappiness=10"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"And to change permanently:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo nano /etc/sysctl.conf"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"And edit the value for vm.swappiness. Then to apply the change:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo sysctl -p"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"vm.vfs_cache_pressure. tells the system how aggressive to be in reclaiming memory. Higher values. (100 or more) tell the system to be more aggressive, To check the present value:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"cat /proc/sys/vm/vfs_cache_pressure"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"To change the value till the next reboot:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo sysctl vm.vfs_cache_pressure=150"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"To change the value permanently:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo nano /etc/sysctl.conf"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"And then add or update the line:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"vm.vfs_cache_pressure = 100"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"And then apply the change:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo sysctl -p"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"What can you do if you monitor your swap space usage and you notice that swap usage is beginning to increase? There is a command that will empty swap space and move the contents to memory. Before using this, you need to make certain that available memory is larger than swap usage. I say available memory because in Linux systems with heavy disk usage \u201ccached memory\u201d can be quite high, so \u201cfree memory\u201d will show as being very low, but \u201ccache memory\u201d will be made available if needed for commands like this."}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo swapoff -a && sudo swapon -a"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Just to be certain I like to force garbage collection also after doing this:"}),"\n",(0,o.jsxs)(s.blockquote,{children:["\n",(0,o.jsx)(s.p,{children:"sudo jcmd $(pgrep java) GC.run"}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Again I hope some people find this information useful. We want to make ERDDAP\u2122 as robust as possible, and to work as seamlessly as possible with how people actually work."})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}}}]);