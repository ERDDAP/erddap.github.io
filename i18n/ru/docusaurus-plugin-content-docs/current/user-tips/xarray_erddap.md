Спасибо Рою Мендельсону за эту статью.

The Python Пакет «xarray» стал очень популярным для доступа, поднастройки и визуализации сетчатых данных в различных форматах. «Xarray» отлично работает ERDDAP™ Как только вы поймете, как правильно его использовать. Я хотел бы отметить, что Python "Эрдапы" " ( https://github.com/ioos/erddapy ) может получить доступ к данным из ERDDAP™ серверы, использующие как «griddap», так и «griddap» tabledap ', в то время как 'xarray' ограничен сетчатыми данными, и 'erddapy' может экспортировать данные для 'xarray'. Но если вы привыкли использовать «xarray» и имеете рабочие процессы с использованием пакета, то может быть желательно просто работать в рамках одного пакета.

Один из моих любимых наборов данных - данные JPL MURv4.1 SST. https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.html . Если я хочу сделать подмножество данных для, скажем, 28 января 2026 года, латитдусы (20,50) и долготы (140, 105) и скачать файл netcdf, ERDDAP™ URL для этого будет https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.nc?analysed_sst[(2026-01-28T09:00:00Z ):1: (2026-01-28T09:00:00Z) [] (20) :1: (50) [] (-140) :1: (105) ] и разумно предположить, что это то, что вы использовали бы в "xarray". Но на самом деле, если вы это сделаете, вы получите ошибку.

Причина, по которой это приводит к ошибке, заключается в том, что «xarray» использует OPeNDAP   ( https://www.opendap.org ) в качестве протокола для удаленного доступа, а также ERDDAP™ Синтаксис основан на OPeNDAP синтаксис, а также ERDDAP™ Сервер также может выступать в качестве OPeNDAP Есть различия в том, как это делается для двух служб. (См., например https://coastwatch.pfeg.noaa.gov/erddap/griddap/documentation.html#opendapLibraries ) .

Если мы думаем о шагах, чтобы получить доступ к местному NetCDF В файле «xarray» мы сделаем следующие шаги:

- Откройте файл, указав на полный путь к файлу
- Посмотрите на координатную информацию с первого шага.
- Используйте один из различных методов «выбора» для поднастройки данных

В приведенном выше файле сначала откройте, затем выполните поднастройку. Использование «xarray» с ERDDAP™ Набор данных вы делаете то же самое, как только вы понимаете, как описано в ERDDAP™ документация, что «путь к файлу» - это URL без какого-либо формата возврата и без каких-либо ограничений, в случае набора данных MUR, который является https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41.
 

В качестве конкретного примера, используя набор данных MUR, сначала нужно импортировать пакеты, которые будут использоваться:


```python
import matplotlib.pyplot as plt
import xarray as xr
```

Затем, как описано выше, я настроил URL-адрес на набор данных «имя» и открыл «файл». (Это не означает, что на самом деле это скопление файлов.) Использование "xr.open_dataset"


```python
mur_url = "https://coastwatch.pfeg.noaa.gov/erddap/griddap/jplMURSST41"
ds = xr.open_dataset(mur_url, decode_times=True)


```

Это приводит к следующему (частичный) Результаты в "ds":

Размеры:

время: 8641l высота: 17999 долгота: 36000

Координаты:

время (время) Дата64[ns] 2002-06-01T09:00:00... 2026-01-...
широта (широта) float32 -89.99 -89.98 ... 89.98 89.99
долгота (долгота) Float32 -180.0 -180.0 ... 180.0 180.0

Индексы:

Время PandasIndex
широта PandasIndex
долгота PandasIndex


На этом этапе вы действуете так же, как если бы это был локальный файл. Я приведу два примера ниже, один из которых берет последние два раза с помощью индексации массива и один, который получает значения последних двух раз и использует это для создания подмножества, но в любом случае это идентично тому, что вы сделали бы для локального файла.


```python
lat_min, lat_max = 20, 50
lon_min, lon_max = -140, -105
sub_isel = ds.isel(time=slice(-2, None)).sel(
    latitude=slice(lat_min, lat_max),
    longitude=slice(lon_min, lon_max),
)
# plot the result
#sub_isel["analysed_sst"].isel(time=0).plot()
```


```python
last2 = ds["time"].values[-2:]
sub_sel = ds.sel(time=last2).sel(
    latitude=slice(lat_min, lat_max),
    longitude=slice(lon_min, lon_max),
)
# plot the result
#sub_sel["analysed_sst"].isel(time=0).plot()


```

Таким образом, домашнее сообщение заключается в том, что «xarray» отлично подходит для сетчатых данных на компьютере. ERDDAP™ Сервер, если вы переходите на xr.open_dataset () Это ERDDAP™ URL без типа файла и ограничений.
