Этот контент основан на [Послание Роя Мендельсона к ERDDAP Группа пользователей](https://groups.google.com/g/erddap/c/zZUt6PKfkoI/m/expZ3UkkBAAJ) .

Недавно мы получили ряд запросов, требующих помощи в доступе к файлам на AWS S3. ERDDAP™ . Сначала ERDDAP™ Версия 2.29 будет иметь улучшенный доступ к S3, который также должен работать с хранилищами объектов, не принадлежащими AWS. (Спасибо, Сет&#33;) . Но я уже упоминал ранее об использовании системы на основе FUSE, чтобы магазин S3 выглядел как файловая система на вашем сервере или виртуальной машине.

Один из способов сделать это — использовать «клон». (https://rclone.org/) . rclone работает на многих различных системах S3 и имеет множество различных настроек для оптимизации производительности, включая настройку размера кэша, что, надеюсь, может компенсировать некоторые штрафы за скорость от запуска FUSE. Преимущества использования клона с ERDDAP ТМ заключается в том, что клон обрабатывает все взаимодействия с S3, поэтому типы наборов данных, такие как EDDGrid FromNcFiles можно использовать как локальные файлы. Это означает, что вам нужно только выяснить, как настроить клон, чтобы получить доступ к вашему объекту, а остальное просто обычные настройки типа Linux.

Теперь я был бы упущен, если бы я просто оставил его на этом, а не привести пример. В следующем я собираюсь анонимно установить NOAA 17 данных, которые находятся в общедоступном магазине AWS S3 на одном из наших серверов Ubuntu, В начальной настройке процесс клона будет запущен на переднем плане, чтобы облегчить проверку того, что все работает, а затем я расскажу, как превратить ii в службу, работающую в фоновом режиме. Обратите внимание, что в том, что ниже, кэш установлен на 1 ГБ. Производительность может быть улучшена за счет увеличения кэша, скажем, на 5 ГБ-10 ГБ или даже больше. Также настройки — это мои догадки о том, что может оптимизировать производительность, но не может быть оптимальным для ERDDAP™ .


1. Установите необходимое программное обеспечение:
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

Обновление Sudo Apt
Sudo Apt установит Rclone Fuse3 -

2. Создайте анонимный пульт S3
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

rclone config create gos17 s3
Поставщик AWS
Восточный регион-1
Location_constraint us-east-1
Env_auth Ложная
Анонимная правда

3. Проверьте это.
——————————————————

rclone lsd gos17:noaa-goes17 | голова

4. Создайте точку крепления для данных
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

sudo mkdir -p/mnt/goes17
Sudo Chown $USER: $USER /mnt/goes17

5. Соберите данные. (Обратите внимание, что этот процесс проходит на переднем плане, поэтому он покажет некоторый выход и будет сидеть там.) 
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

rclone -vv mount gos17:noaa-goes17/mnt/goes17
только для чтения
-vfs-cache-mode полный
-vfs-cache-max-size 1G
vfs-cache-poll-интервал 1м\\
-vfs-read-chunk-size 64М \\
-vfs-read-chunk-size-limit 1G
-vfs-read-ahead 256 М \\
Размер буфера 64М
-время дир-кэша 24 ч
— Attr-Timeout 1s
- без времени

6. Откройте новую вкладку на сервере и проверьте
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

ls/mnt/goes17 | голова

7. Убедитесь, что данные могут быть доступны
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
cd/mnt/goes17/ABI-L1b-RadC/2023/010/15
слияние - OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c20230101541461 .nc 
```
netcdf OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c20230101541461 {
dimensions:
y = 1500 ;
x = 2500 ;
number_of_time_bounds = 2 ;
band = 1 ;
number_of_image_bounds = 2 ;
num_star_looks = 24 ;
variables:
short Rad(y, x) ;
Rad:_FillValue = 1023s ;
Rad:long_name = "ABI L1b Radiances" ;
Rad:standard_name = "toa_outgoing_radiance_per_unit_wavenumber" ;
Rad:_Unsigned = "true" ;
Rad:sensor_band_bit_depth = 10b ;
Rad:valid_range = 0s, 1022s ;
Rad:scale_factor = 0.1760585f ;
Rad:add_offset = -5.2392f ;
Rad:units = "mW m-2 sr-1 (cm-1)-1" ;
Rad:resolution = "y: 0.000056 rad x: 0.000056 rad" ;
Rad:coordinates = "band_id band_wavelength t y x" ;
Rad:grid_mapping = "goes_imager_projection" ;
Rad:cell_methods = "t: point area: point" ;
Rad:ancillary_variables = "DQF" ;
.
.
.
.
```
Результат был возвращен на удивление быстро, тем более что наша установка не имеет самой быстрой трубы в мире.

8. Превратить в системный сервис (изменяться в соответствии с требованиями пользователя и т.д.) :
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

а. Создайте системный блок:

sudo nano/etc/systemd/system/rclone-goes17.service

И введите:

[единица]
Описание = Установка наклона для GOES17 public S3
After=network-online .tar получать

[Услуга]
Тип = простой
Пользователь:ubuntu
ExecStart=/usr/bin/rclone mount gos17:noaa-goes17/mnt/goes17
только для чтения
-vfs-cache-mode полный
-vfs-cache-max-size 1G
vfs-cache-poll-интервал 1м\\
-vfs-read-chunk-size 64М \\
-vfs-read-chunk-size-limit 1G
-vfs-read-ahead 256 М \\
Размер буфера 64М
-время дир-кэша 24 ч
— Attr-Timeout 1s
- нет времени
-s3-no-check-bucket
ExecStop=/bin/fusermount3 -u/mnt/goes17
Восстановление всегда
RestartSec=10

[Установить]
WantedBy = многопользовательский .tar получать

Б. Включите сервис и начните:

sudo systemctl daemon перезагрузка
sudo systemctl enable — теперь rclone-goes17

c. Тест

системный статус rclone-goes17
ls/mnt/goes17 | голова



Надеюсь, это будет полезно людям. Мы тестировали использование gcsfuse на облачной платформе Google с некоторым успехом. Одно из преимуществ клона (Кроме того, он не является поставщиком конкретных) Он имеет больше настроек для оптимизации производительности. Особенно если вы переезжаете в местный ERDDAP™ В облаке это может сделать переход практически бесшовным.
