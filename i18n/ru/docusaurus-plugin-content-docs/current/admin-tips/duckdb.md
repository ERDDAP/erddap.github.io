Этот контент основан на [Послание Роя Мендельсона к ERDDAP Группа пользователей](https://groups.google.com/g/erddap/c/6Hl024ZGkes/m/DS5WzsydAQAJ) .

 ERDDAP™ Мы стараемся быть агностиками в отношении того, какие форматы данных люди используют для своих данных, вместо этого пытаясь работать с форматами данных, которые чаще всего используются в сообществах, которым мы в основном обслуживаем. Поскольку все больше и больше работы происходит в облаке, и существует множество форматов данных, которые люди используют в облаке, было бы неплохо, если бы это было так. ERDDAP™ Они могут поддерживать многие из этих форматов. Увы, ERDDAP™ уже недоукомплектованы персоналом, и было бы желательно использовать работу других для достижения этой цели без необходимости внесения изменений; ERDDAP™ .

Входить [DuckDB](https://duckdb.org/) и [Трино](https://trino.io/) . Оба они обеспечивают подключение к различным форматам данных и могут быть доступны с помощью JDBC. В этой статье я буду рассматривать только использование DuckDB, потому что у меня есть некоторое знакомство с ним, и Трино, по крайней мере, на мой взгляд, казалось немного сложнее настроить, и прямо сейчас я просто хотел доказательство концепции. (Некоторое время назад Дэмиен Смайт написал, что он подавал иск о том, как использовать Трино, и я связался с ним, и он сделал это, чтобы работать, и отправит мне заметки.) . Кроме того, я хоть что-то, кроме эксперта по любому из этих вопросов, так что это изучение вместе со мной - дайте мне знать, если вы найдете какие-либо ошибки, или вещи, которые неясны, или если есть лучшие способы делать вещи.

1. Предварительные:
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

Для использования DuckDB в ERDDAP™ Вам нужно установить duckDB на свой компьютер и установить разъем DuckDB JDBC на компьютер. ERDDAP™ . Инструкции по установке самого DuckDB

https://duckdb.org/docs/installation/?version=stable&environment=cli&platform=macos&download_method=direct

Разъем DuckDB JDBC можно скачать

https://duckdb.org/docs/stable/clients/java.html

Если ваш томкат находится по адресу $TOMCAT_HOME, то вы хотите разместить этот файл по адресу $TOMCAT_HOME/webapps/erddap/WEB-INF/lib.

2. Что делает это сложным:
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————


По крайней мере для DuckDB. (Как я уже говорил, я не смотрел на Трино в деталях.)   Java Программы могут получить доступ к DuckDB только через разъем JDBC, а разъем JDBC может считывать только данные, которые хранятся в формате DuckDB .db. В то время как DuckDB является отличным инструментом, копирование данных в этом формате нарушает цель, DuckDB предоставляет возможность для многих поддерживаемых форматов файлов. (Растет список расширений) Вы можете настроить виртуальный файл .db, который просто читает необходимые метаданные. Я обнаружил, что .db, созданный для небольшого размера, обеспечивает быстрый доступ. Интересно отметить, что в отличие от большинства систем баз данных (включая Трино) С Даком У вас нет приложения, которое постоянно работает в фоновом режиме, поэтому должно быть некоторое отставание в доступе из-за запуска, но, как я сказал в своих небольших тестах, доступ кажется быстрым.


3. Простой пример:
————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

Для начала рассмотрим, как это сделать с помощью файла .csv. Правильно, это не так интересно в случае использования, как ERDDAP™ Уже довольно хорошо обрабатывает файлы .csv, поэтому ничего не получается в этом смысле, но текстовый файл легче работать и отлаживать, видя, что происходит. Ниже мы рассмотрим более интересный вариант использования, как только увидим, что необходимо.

Файл, с которым я работаю, называется «detects.csv», который представляет собой 305 МБ файл обнаружения тегов датчиками. Первым шагом является создание файла .db, который указывает на этот файл. (В этом и в том, что следует для удобства, я всегда буду считать, что вы работаете на необходимом уровне, поэтому я не даю полных путей - на практике вам придется) :

```
duckdb detects.db <<EOF
CREATE VIEW detects_table AS
SELECT *
FROM read_csv_auto(
'detects.csv',
header=true,
sample_size=2147483647 -- scan whole file for schema (optional)
);
EOF
```

Файл «detects.db» имеет размер 268 КБ. Мы можем проверить, действительно ли это сработало:

```
duckdb detects.db
DuckDB v1.3.1 (Ossivalis) 2063dda3e6
Enter ".help" for usage hints.
D SHOW TABLES;
┌───────────────┐
│ name │
│ varchar │
├───────────────┤
│ detects_table │
└───────────────┘
D SELECT * FROM detects_table LIMIT 5;
┌────────────────┬─────────┬──────────────┬───────┬──────────┬───┬──────────┬──────────────┬───────────────┬─────────┐
│ Study_ID │ TagCode │ DateTime_PST │ recv │ location │ … │ tag_life │ Rel_latitude │ Rel_longitude │ time │
│ varchar │ varchar │ timestamp │ int64 │ varchar │ │ int64 │ double │ double │ varchar │
├────────────────┼─────────┼──────────────┼───────┼──────────┼───┼──────────┼──────────────┼───────────────┼─────────┤
│ ButteSink_2024 │ 1B76 │ NULL │ NULL │ NULL │ … │ 52 │ 39.32663 │ -121.8847 │ -08 │
│ ButteSink_2024 │ 1B94 │ NULL │ NULL │ NULL │ … │ 52 │ 39.32663 │ -121.8847 │ -08 │
│ ButteSink_2024 │ 1BA5 │ NULL │ NULL │ NULL │ … │ 52 │ 39.35858 │ -121.8943 │ -08 │
│ ButteSink_2024 │ 1C55 │ NULL │ NULL │ NULL │ … │ 52 │ 39.33546 │ -121.8923 │ -08 │
│ ButteSink_2024 │ 1C95 │ NULL │ NULL │ NULL │ … │ 52 │ 39.33546 │ -121.8923 │ -08 │
├────────────────┴─────────┴──────────────┴───────┴──────────┴───┴──────────┴──────────────┴───────────────┴─────────┤
│ 5 rows 18 columns (9 shown) │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

и величину обнаружений. ДБ не изменился от проведения этой операции. Итак, последний шаг состоит в том, чтобы связать это с ERDDAP™ Я покажу только часть, необходимую для подключения к файлу, а не всю переменную информацию:

```
<dataset type="EDDTableFromDatabase" datasetID="duckdb_test" active="true">
<!-- JDBC Connection Details -->
<sourceUrl>jdbc:duckdb:detects.db</sourceUrl>
<driverName>org.duckdb.DuckDBDriver</driverName>
<catalogName></catalogName>
<schemaName></schemaName>
<tableName>detects_table</tableName>
<columnNameQuotes></columnNameQuotes>
>
```

И это набор данных в ERDDAP™ На моем ноутбуке с помощью разъема DuckDB:
