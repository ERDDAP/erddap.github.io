Этот контент основан на [Послание Роя Мендельсона к ERDDAP Группа пользователей](https://groups.google.com/g/erddap/c/1U0OByOasu4/m/JM39reEsBAAJ) .

Многие запросы на помощь, которые мы получаем, связаны с проблемами использования памяти. ERDDAP™ . Это связано с изменениями в управлении памятью. Java а также взаимодействие с управлением памятью ОС Linux. Начав, я верю в Java 17, Java использует больше памяти, чем то, что помещается в настройках кучи. Вы можете увидеть это, если посмотрите на настройки кучи, а затем используйте команды, такие как top, htop или btop, чтобы проверить использование памяти приложений. Так, например, наш широко используемый ERDDAP™ имеет кучу пространства, установленного на 21 ГБ, но на самом деле использование памяти может работать до 28 ГБ-30 ГБ, иногда выше. Это значение может увеличиться, если в систему поступает много одновременно больших запросов.

В большинстве систем Linux, как только использование памяти превысит 50%, ОС начнет заменять память. Более того, для большинства систем своп-пространство не является мусором, собираемым до тех пор, пока это абсолютно необходимо. ERDDAP™ опаздывает и может вызвать ERDDAP™ Заморозить. И своп-пространство медленное, которое для больших datasets.xml Это может привести к тому, что основные обновления не будут завершены, что усугубит проблемы.

Что ты можешь с этим поделать? Во-первых, узнайте истинное использование памяти или вашей системы и имейте достаточно оперативной памяти, чтобы использование памяти не превышало 50%. Но есть также две настройки, которые могут изменить это поведение, vm.swappiness. vm.vfs_cache_pressure.

vm.swappiness контролирует, насколько агрессивно ядро Linux использует пространство подкачки. Вы можете проверить его текущее значение с помощью:

> cat /proc/sys/vm/swappiness
>
• По умолчанию обычно 60 (по шкале от 0 до 100) .
• Более низкие значения делают систему менее вероятной для замены.
• Значение 10 или 1 часто используется для систем с большим количеством оперативной памяти.


Чтобы изменить значение до перезагрузки, скажите 10:

> sudo sysctl vm.swappiness=10
>

Чтобы навсегда измениться:

> sudo nano /etc/sysctl.conf
>

И отредактировать значение для vm.swappiness. Затем применить изменения:

> sudo sysctl -p
>

vm.vfs_cache_pressure. Он говорит системе, насколько агрессивно нужно восстанавливать память. Высшие ценности. (100 или более) Скажите системе быть более агрессивной, чтобы проверить текущую стоимость:

> cat /proc/sys/vm/vfs_cache_pressure
>

Чтобы изменить значение до следующей перезагрузки:

> sudo sysctl vm.vfs_cache_pressure=150
>

Для постоянного изменения стоимости:

> sudo nano /etc/sysctl.conf
>

Затем добавьте или обновите строку:

> vm.vfs_cache_pressure = 100
>

Затем внесите изменения:

> sudo sysctl -p
>


Что вы можете сделать, если вы отслеживаете использование пространства подкачки и замечаете, что использование подкачки начинает увеличиваться? Есть команда, которая опустошает пространство обмена и перемещает содержимое в память. Прежде чем использовать это, вы должны убедиться, что доступная память больше, чем использование свопа. Я говорю о доступной памяти, потому что в системах Linux с тяжелым использованием диска «кэшированная память» может быть довольно высокой, поэтому «бесплатная память» будет отображаться как очень низкая, но «кэш-память» будет доступна, если это необходимо для таких команд.

> sudo swapoff -a && sudo swapon -a
>

Просто чтобы быть уверенным Мне нравится собирать мусор после этого:

> sudo jcmd $(pgrep java) GC.run
>

Я надеюсь, что некоторые люди найдут эту информацию полезной. Мы хотим сделать ERDDAP™ Как можно надежнее и работать максимально плавно с тем, как люди на самом деле работают.
