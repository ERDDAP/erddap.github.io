Το περιεχόμενο αυτό βασίζεται σε [Μήνυμα από Roy Mendelssohn στο ERDDAP Ομάδα χρηστών](https://groups.google.com/g/erddap/c/1U0OByOasu4/m/JM39reEsBAAJ) .

Πολλά από τα αιτήματα βοήθειας που λαμβάνουμε περιλαμβάνουν προβλήματα με τη χρήση μνήμης ERDDAP™ . Μερικά από αυτά προέρχονται από αλλαγές στη διαχείριση μνήμης Java , και επίσης αλληλεπιδράσεις με τη διαχείριση μνήμης Linux OS. Ξεκινώντας πιστεύω σε Java 17, Ο Πρόεδρος Java χρησιμοποιεί περισσότερη μνήμη από ό, τι τίθεται κάτω στις ρυθμίσεις σωρό. Μπορείτε να το δείτε αυτό αν κοιτάξετε τις ρυθμίσεις του σωρού σας και στη συνέχεια χρησιμοποιήσετε εντολές όπως κορυφή, htop, ή btop για να ελέγξετε τη χρήση μνήμης των εφαρμογών. Έτσι, για παράδειγμα, η βαριά μας χρήση ERDDAP™ έχει χώρο σωρό σε 21GB, αλλά στην πραγματικότητα η χρήση μνήμης μπορεί να τρέξει σε 28GB-30GB, μερικές φορές υψηλότερη. Αυτή η τιμή μπορεί να αυξηθεί αν υπάρχουν πολλά ταυτόχρονα μεγάλα αιτήματα προς το σύστημα.

Στα περισσότερα συστήματα Linux, μόλις η χρήση μνήμης ξεπεράσει περίπου το 50%, το λειτουργικό σύστημα θα αρχίσει να ανταλλάσσει μνήμη. Επιπλέον, για τα περισσότερα συστήματα swap χώρο δεν είναι τα σκουπίδια που συλλέγονται μέχρι απολύτως απαραίτητο, η οποία για ERDDAP™ είναι πολύ αργά, και μπορεί να προκαλέσει ERDDAP™ να παγώσει. Και το χώρο ανταλλαγής είναι αργό, το οποίο για μεγάλο datasets.xml μπορεί να προκαλέσει σημαντικές ενημερώσεις να μην ολοκληρωθεί, η οποία στη συνέχεια να επιδεινώσει τα προβλήματα.

Τι μπορείς να κάνεις γι' αυτό; Πρώτα, μάθετε την πραγματική χρήση μνήμης ή το σύστημά σας, και να έχουν αρκετή RAM έτσι ώστε η χρήση μνήμης να μην υπερβαίνει το 50%. Αλλά υπάρχουν επίσης δύο ρυθμίσεις που μπορούν να αλλάξουν αυτή τη συμπεριφορά, vm.swapity. και vm.vfs_cache_πίεση.

Vm.swoappiness ελέγχει πόσο επιθετικά ο πυρήνας Linux χρησιμοποιεί swap space. Μπορείτε να ελέγξετε την τρέχουσα τιμή του με:

> cat /proc/sys/vm/swappiness
>
• Προκαθορισμένο είναι συνήθως 60 (σε κλίμακα από 0 έως 100) .
• Οι χαμηλότερες τιμές καθιστούν το σύστημα λιγότερο πιθανό να αλλάξει.
• Μια τιμή 10 ή 1 χρησιμοποιείται συχνά για συστήματα με άφθονο RAM.


Για να αλλάξετε την τιμή μέχρι την επανεκκίνηση, πείτε στο 10:

> sudo sysctl vm.swappiness=10
>

Και για να αλλάξει μόνιμα:

> sudo nano /etc/sysctl.conf
>

Και επεξεργαστείτε την τιμή για vm.swopiness. Στη συνέχεια να εφαρμόσει την αλλαγή:

> sudo sysctl -p
>

Vm.vfs_cache_πίεση. λέει στο σύστημα πόσο επιθετικό να είναι στην ανάκτηση μνήμης. Υψηλότερες αξίες. (100 ή περισσότερο) Για να ελέγξετε την παρούσα τιμή:

> cat /proc/sys/vm/vfs_cache_pressure
>

Για να αλλάξετε την τιμή μέχρι την επόμενη επανεκκίνηση:

> sudo sysctl vm.vfs_cache_pressure=150
>

Για να αλλάξετε μόνιμα την τιμή:

> sudo nano /etc/sysctl.conf
>

Και στη συνέχεια να προσθέσετε ή να ενημερώσετε τη γραμμή:

> vm.vfs_cache_pressure = 100
>

Και μετά εφαρμόστε την αλλαγή:

> sudo sysctl -p
>


Τι μπορείτε να κάνετε αν παρακολουθείτε τη χρήση του χώρου swap σας και παρατηρήσετε ότι η χρήση swap αρχίζει να αυξάνεται; Υπάρχει μια εντολή που θα αδειάσει χώρο ανταλλαγής και θα μετακινήσει τα περιεχόμενα στη μνήμη. Πριν χρησιμοποιήσετε αυτό, θα πρέπει να βεβαιωθείτε ότι η διαθέσιμη μνήμη είναι μεγαλύτερη από τη χρήση swap. Λέω διαθέσιμη μνήμη, επειδή σε συστήματα Linux με βαριά χρήση δίσκου «καλυμμένη μνήμη» μπορεί να είναι αρκετά υψηλή, έτσι η «ελεύθερη μνήμη» θα δείξει ότι είναι πολύ χαμηλή, αλλά «η μνήμη cache» θα είναι διαθέσιμη αν χρειαστεί για εντολές όπως αυτή.

> sudo swapoff -a && sudo swapon -a
>

Για να είμαι σίγουρος. Μου αρέσει να πιέζω και τη συλλογή σκουπιδιών μετά από αυτό:

> sudo jcmd $(pgrep java) GC.run
>

Και πάλι ελπίζω κάποιοι να βρουν αυτή την πληροφορία χρήσιμη. Θέλουμε να κάνουμε ERDDAP™ όσο το δυνατόν πιο στιβαρό, και να λειτουργήσει όσο το δυνατόν πιο απρόσκοπτα με τον τρόπο με τον οποίο οι άνθρωποι εργάζονται πραγματικά.
