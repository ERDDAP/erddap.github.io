Το περιεχόμενο αυτό βασίζεται σε [Μήνυμα από Roy Mendelssohn στο ERDDAP Ομάδα χρηστών](https://groups.google.com/g/erddap/c/zZUt6PKfkoI/m/expZ3UkkBAAJ) .

Πρόσφατα, έχουμε λάβει μια σειρά από έρευνες που ζητούν βοήθεια για την πρόσβαση αρχεία για AWS S3 σε ERDDAP™ . Πρώτον, ERDDAP™ Η έκδοση 2.29 θα έχει βελτιώσει την πρόσβαση S3 η οποία θα πρέπει να λειτουργεί και με μη AWS καταστήματα αντικειμένων. (Ευχαριστώ Σεθ&#33;) . Αλλά έχω αναφέρει προηγουμένως σχετικά με τη χρήση ενός συστήματος βάσης FUSE για να κάνει το κατάστημα S3 να εμφανίζεται σαν ένα σύστημα αρχείων στον server σας ή VM.

Ένας τρόπος για να το κάνουμε αυτό είναι να χρησιμοποιήσουμε το “clone”. (https://rclone.org/) . rclone λειτουργεί σε πολλά διαφορετικά συστήματα S3, και έχει πολλές διαφορετικές ρυθμίσεις για τη βελτιστοποίηση της απόδοσης, συμπεριλαμβανομένου του καθορισμού ενός μεγέθους cache, η οποία ελπίζουμε ότι μπορεί να αντισταθμίσει κάποια από την ποινή ταχύτητας από το τρέξιμο FUSE. Το πλεονέκτημα της χρήσης rclone με ERDDAP TM είναι ότι rclone χειρίζεται όλη την αλληλεπίδραση με S3, έτσι ώστε τύποι σύνολο δεδομένων όπως EDDGrid FromNcFiles μπορεί να χρησιμοποιηθεί άμεσα σαν να υπάρχουν τοπικά αρχεία. Αυτό σημαίνει ότι πρέπει μόνο να υπολογίσετε πώς να ρυθμίσετε rclone για να έχετε πρόσβαση στο κατάστημα αντικειμένων σας, και τα υπόλοιπα είναι απλά κανονικές ρυθμίσεις τύπου Linux.

Τώρα θα ήμουν αμελής αν το άφηνα έτσι και δεν έδινα το παράδειγμα. Στο εξής θα ανώνυμα ανεβάσω το NOAA Goes17 δεδομένα που είναι σε ένα δημόσιο προσβάσιμο κατάστημα AWS S3 σε έναν από τους εξυπηρετητές μας Ubuntu, Στην αρχική ρύθμιση η διαδικασία rclone θα εκτελείται στο προσκήνιο για να είναι ευκολότερο να ελεγχθεί ότι όλα λειτουργούν, και στη συνέχεια θα συζητήσουμε πώς να μετατρέψει το ii σε μια υπηρεσία που εκτελείται στο παρασκήνιο. Σημειώστε ότι στην παρακάτω περίπτωση, η κρύπτη έχει οριστεί σε 1GB. Η απόδοση μπορεί κάλλιστα να ενισχυθεί κάνοντας την κρύπτη πολύ μεγαλύτερη, ας πούμε 5GB-10GB ή ακόμα μεγαλύτερη. Επίσης οι ρυθμίσεις είναι εικασίες μου σε ό, τι μπορεί να βελτιστοποιήσει την απόδοση, αλλά μπορεί να μην είναι οι βέλτιστες για ERDDAP™ .


1. Εγκαταστήστε το απαραίτητο λογισμικό:
———————————————

ενημέρωση sudo apt
sudo apt εγκατάσταση rclone fit3 - Ναι.

2. Δημιουργία ενός ανώνυμου απομακρυσμένου S3
————————————————————

rclone config δημιουργία goes17 s3 \\
Παροχέας AWS \\
περιοχή μας-ανατολικά-1 \\1
τοποθεσία_περιορισμός μας-ανατολικά-1 \\
elv_auth false \\
ανώνυμο αληθές

3. Δοκίμασέ το.
—————

Rclone lsd goes17:noaa-goes17 | Κεφαλή

4. Δημιουργία σημείου προσάρτησης για τα δεδομένα
————————————————————

sudo mkdir - p / mnt/goes17
sudo chown $USER: $USER /mnt/goes17

5. Προσαρτήστε τα δεδομένα. (Σημειώστε ότι αυτή η διαδικασία τρέχει στο προσκήνιο, έτσι θα δείξει κάποια έξοδο και να καθίσει εκεί) 
———————————

Rclone -vv mount goes17:noaa-goes17 /mnt/goes17 \\
--μόνο ανάγνωση \\
--vfs-cache-mode πλήρης \\
--vfs-cache-μέγιστο μέγεθος 1G \\
--vfs-cache-poll-interval 1m \\
--vfs-read-chunk-μέγεθος 64M \\
--vfs-read-chunk-μέγεθος-όριο 1G \\
--vfs-ανάγνωση-προς 256M \\
--μεγέθους μεγέθους 64M \\
--Dir-cache-time 24 ώρες \\
--κατά-τάιμ άουτ 1s \\
--όχι-τροπό χρόνο

6. Άνοιγμα νέας καρτέλας στον εξυπηρετητή και έλεγχος
————————————————

ls /mnt/goes17 | Κεφαλή

7. Έλεγχος της πρόσβασης στα δεδομένα
———————————————————————
cd /mnt/goes17/ABI-L1b-RadC/2023/01/15
ncdump -Η OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c2023010541461 .nc 
```
netcdf OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c20230101541461 {
dimensions:
y = 1500 ;
x = 2500 ;
number_of_time_bounds = 2 ;
band = 1 ;
number_of_image_bounds = 2 ;
num_star_looks = 24 ;
variables:
short Rad(y, x) ;
Rad:_FillValue = 1023s ;
Rad:long_name = "ABI L1b Radiances" ;
Rad:standard_name = "toa_outgoing_radiance_per_unit_wavenumber" ;
Rad:_Unsigned = "true" ;
Rad:sensor_band_bit_depth = 10b ;
Rad:valid_range = 0s, 1022s ;
Rad:scale_factor = 0.1760585f ;
Rad:add_offset = -5.2392f ;
Rad:units = "mW m-2 sr-1 (cm-1)-1" ;
Rad:resolution = "y: 0.000056 rad x: 0.000056 rad" ;
Rad:coordinates = "band_id band_wavelength t y x" ;
Rad:grid_mapping = "goes_imager_projection" ;
Rad:cell_methods = "t: point area: point" ;
Rad:ancillary_variables = "DQF" ;
.
.
.
.
```
Το αποτέλεσμα επέστρεψε εκπληκτικά γρήγορα, ιδιαίτερα αφού η εγκατάστασή μας δεν έχει τον ταχύτερο σωλήνα στον κόσμο.

8. Κάντε μια υπηρεσία συστήματος (να τροποποιεί ανάλογα με την περίπτωση για τον χρήστη κ.λπ.) :
———————————————————

α. Δημιουργία μιας συστημένης μονάδας:

sudo nano /etc/συστηματοποιημένο/σύστημα/rclone-goes17.service

Και μπαίνετε:

[Μονάδα]
Περιγραφή = Βάση Rclone για GOES17 δημόσιο S3
Μετά=network-online .tar Πάρτε

[Υπηρεσία]
Τύπος=απλή
Χρήστης=ubuntu
ExecStart=/usr/bin/rclone mount go17:noaa-goes17/mnt/goes17 \\
--μόνο ανάγνωση \\
--vfs-cache-mode πλήρης \\
--vfs-cache-μέγιστο μέγεθος 1G \\
--vfs-cache-poll-interval 1m \\
--vfs-read-chunk-μέγεθος 64M \\
--vfs-read-chunk-μέγεθος-όριο 1G \\
--vfs-ανάγνωση-προς 256M \\
--μεγέθους μεγέθους 64M \\
--Dir-cache-time 24 ώρες \\
--κατά-τάιμ άουτ 1s \\
--όχι-τροποποίηση \\
--s3-no-check-bucket
ExecStop=/bin/fusermount3 -u /mnt/goes17
Επανεκκίνηση=πάντα
ΕπανεκκίνησηSec=10

[Εγκατάσταση]
WantedBy=πολυχρήστης .tar Πάρτε

β. Ενεργοποίηση της υπηρεσίας και εκκίνηση:

sudo systemctl daemon- reload (σύνταξη sudo)
sudo systemctl ενεργοποίηση - τώρα rclone-goes17

γ. Δοκιμή

systemctl status rclone-goes17
ls /mnt/goes17 | Κεφαλή



Ελπίζω αυτό να είναι χρήσιμο για τους ανθρώπους. Έχουμε δοκιμαστεί χρησιμοποιώντας gcsfuse στην πλατφόρμα Google Cloud με ένα κουβά που έχει ιεραρχικό χώρο όνομα με κάποια επιτυχία. Ένα πλεονέκτημα του rclone (Εξάλλου, δεν είναι συγκεκριμένος πωλητής.) είναι ότι έχει περισσότερες ρυθμίσεις για τη βελτιστοποίηση της απόδοσης. Ειδικά αν μετακινείτε ένα τοπικό ERDDAP™ στο σύννεφο, αυτό μπορεί να κάνει τη μετάβαση σχεδόν απρόσκοπτη.
