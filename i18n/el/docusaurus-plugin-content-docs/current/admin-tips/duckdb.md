Το περιεχόμενο αυτό βασίζεται σε [Μήνυμα από Roy Mendelssohn στο ERDDAP Ομάδα χρηστών](https://groups.google.com/g/erddap/c/6Hl024ZGkes/m/DS5WzsydAQAJ) .

 ERDDAP™ προσπαθεί να είναι αγνωστικιστής σχετικά με το τι μορφές δεδομένων που χρησιμοποιούν οι άνθρωποι για τα δεδομένα τους, αντί να προσπαθεί να συνεργαστεί με τις μορφές δεδομένων που χρησιμοποιούν περισσότερο στις κοινότητες που εξυπηρετούμε κυρίως. Καθώς όλο και περισσότερη εργασία είναι στο σύννεφο, και υπάρχουν μια πληθώρα των μορφών δεδομένων που οι άνθρωποι χρησιμοποιούν στο σύννεφο, θα ήταν ωραίο αν ERDDAP™ θα μπορούσε να υποστηρίξει πολλές από αυτές τις μορφές. Αλίμονο, ERDDAP™ η ανάπτυξη και η συντήρηση είναι ήδη ανεπαρκής, και αυτό που θα ήταν επιθυμητό είναι να αξιοποιηθεί το έργο των άλλων για την επίτευξη αυτού του στόχου, χωρίς να χρειάζεται να τροποποιηθεί ERDDAP™ .

Είσοδος [ΠάπιαDB](https://duckdb.org/) και [Τρίνο](https://trino.io/) . Και τα δύο αυτά παρέχουν συνδέσεις με μια ποικιλία μορφών δεδομένων, και μπορούν να προσπελαστούν χρησιμοποιώντας JDBC. Σε αυτή την εγγραφή θα κοιτάξω μόνο τη χρήση DuckDB επειδή έχω κάποια εξοικείωση με αυτό, και Trino τουλάχιστον κατά τη γνώμη μου, φαινόταν λίγο πιο περίπλοκη για να συσταθεί, και αυτή τη στιγμή απλά ήθελα μια απόδειξη της έννοιας. (Πριν λίγο καιρό, ο Ντάμιεν Σμάιθ είχε γράψει ότι είχε ανακαλύψει πώς να χρησιμοποιήσω τον Τρίνο και επικοινώνησα μαζί του και το έκανε να δουλέψει και θα μου στείλει σημειώσεις - έτσι περισσότερα σε αυτό στο μέλλον) . Επίσης, είμαι κάτι άλλο εκτός από ειδικός σε όλα αυτά, οπότε αυτό μαθαίνει μαζί μου - ενημερώστε με αν βρείτε λάθη, ή πράγματα που είναι ασαφή, ή αν υπάρχουν καλύτεροι τρόποι για να κάνουμε πράγματα.

1. Προκαταρκτικά:
———————

Για να χρησιμοποιήσετε το DuckDB σε ERDDAP™ θα πρέπει να εγκαταστήσετε πάπια DB στον υπολογιστή σας, και να εγκαταστήσετε το συνδετήρα DuckDB JDBC σε ERDDAP™ . Οδηγίες για την εγκατάσταση της ίδιας της DuckDB είναι σε

https://duckdb.org/docs/installation/?version=stable&environment=cli&platform=macos&download_method=direct

Ο σύνδεσμος DuckDB JDBC μπορεί να μεταφορτωθεί από

https://duckdb.org/docs/stable/clients/java.html

Αν το tomcat σας βρίσκεται στο $TOMCAT_HOME, τότε θέλετε να βάλετε αυτό το αρχείο στο $TOMCAT_HOME/webapps/erddap/WEB-INF/lib.

2. Τι το κάνει αυτό δύσκολο:
———————————————————


Τουλάχιστον για το DuckDB (όπως έχω πει δεν έχω κοιτάξει Trino σε καμία λεπτομέρεια)   Java τα προγράμματα μπορούν να έχουν πρόσβαση μόνο στην DuckDB μέσω του συνδετήρα JDBC, και ο συνδετήρας JDBC μπορεί να διαβάσει μόνο τα δεδομένα που αποθηκεύονται στη μορφή DuckDB .db. Ενώ DuckDB είναι ένα μεγάλο εργαλείο, που πρέπει να αντιγράψετε τα δεδομένα σε αυτή τη μορφή νικά το όλο σκοπό, Ωστόσο, DuckDB παρέχει τη δυνατότητα που για πολλές από τις μορφές αρχείων που υποστηρίζει (υπάρχει μια αυξανόμενη λίστα των επεκτάσεων) μπορείτε να ρυθμίσετε ένα εικονικό αρχείο .db που διαβάζει μόνο στα απαραίτητα μεταδεδομένα. Βρήκα το .db που δημιουργείται να είναι αρκετά μικρό σε μέγεθος, και παρέχει ό, τι φαίνεται να είναι γρήγορη πρόσβαση. Μια ενδιαφέρουσα σημείωση είναι ότι σε αντίθεση με τα περισσότερα συστήματα βάσεων δεδομένων (και συμπεριλαμβανομένου του Trino) , με πάπια DB δεν έχετε μια εφαρμογή που τρέχει συνεχώς στο παρασκήνιο, έτσι πρέπει να υπάρχει κάποια καθυστέρηση στην πρόσβαση λόγω εκκίνησης, αλλά όπως είπα στις μικρές δοκιμές μου η πρόσβαση φαίνεται γρήγορη.


3. Ένα απλό παράδειγμα:
————————————————

Για αρχή, θα κοιτάξω πώς θα το κάνω αυτό με ένα αρχείο .csv. Σωστό, αυτό δεν είναι ενδιαφέρον μιας περίπτωσης χρήσης όπως ERDDAP™ ήδη χειρίζεται .csv αρχεία αρκετά καλά, οπότε τίποτα δεν κερδίζεται με αυτή την έννοια, αλλά ένα αρχείο κειμένου είναι πιο εύκολο να συνεργαστεί με και να αποσφαλματώσει βλέποντας τι συμβαίνει, και όπως μάθαινα αυτό έκανε τη ζωή μου ευκολότερη. Παρακάτω θα εξετάσω μια πιο ενδιαφέρουσα περίπτωση χρήσης μόλις δούμε τι χρειάζεται.

Το αρχείο με το οποίο εργάζομαι ονομάζεται “ανιχνευτές.csv” το οποίο είναι ένα αρχείο 305MB ανίχνευσης ετικετών από αισθητήρες. Το πρώτο βήμα είναι να δημιουργήσετε ένα αρχείο .db που δείχνει αυτό το αρχείο (Συζητήσεις του Ευρωπαϊκού Κοινοβουλίου) :

```
duckdb detects.db <<EOF
CREATE VIEW detects_table AS
SELECT *
FROM read_csv_auto(
'detects.csv',
header=true,
sample_size=2147483647 -- scan whole file for schema (optional)
);
EOF
```

Το αρχείο “ανιχνεύει.db” είναι 268KB σε μέγεθος. Μπορούμε να ελέγξουμε ότι αυτό έχει πραγματικά λειτουργήσει:

```
duckdb detects.db
DuckDB v1.3.1 (Ossivalis) 2063dda3e6
Enter ".help" for usage hints.
D SHOW TABLES;
┌───────────────┐
│ name │
│ varchar │
├───────────────┤
│ detects_table │
└───────────────┘
D SELECT * FROM detects_table LIMIT 5;
┌────────────────┬─────────┬──────────────┬───────┬──────────┬───┬──────────┬──────────────┬───────────────┬─────────┐
│ Study_ID │ TagCode │ DateTime_PST │ recv │ location │ … │ tag_life │ Rel_latitude │ Rel_longitude │ time │
│ varchar │ varchar │ timestamp │ int64 │ varchar │ │ int64 │ double │ double │ varchar │
├────────────────┼─────────┼──────────────┼───────┼──────────┼───┼──────────┼──────────────┼───────────────┼─────────┤
│ ButteSink_2024 │ 1B76 │ NULL │ NULL │ NULL │ … │ 52 │ 39.32663 │ -121.8847 │ -08 │
│ ButteSink_2024 │ 1B94 │ NULL │ NULL │ NULL │ … │ 52 │ 39.32663 │ -121.8847 │ -08 │
│ ButteSink_2024 │ 1BA5 │ NULL │ NULL │ NULL │ … │ 52 │ 39.35858 │ -121.8943 │ -08 │
│ ButteSink_2024 │ 1C55 │ NULL │ NULL │ NULL │ … │ 52 │ 39.33546 │ -121.8923 │ -08 │
│ ButteSink_2024 │ 1C95 │ NULL │ NULL │ NULL │ … │ 52 │ 39.33546 │ -121.8923 │ -08 │
├────────────────┴─────────┴──────────────┴───────┴──────────┴───┴──────────┴──────────────┴───────────────┴─────────┤
│ 5 rows 18 columns (9 shown) │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

και το μέγεθος των ανιχνευτών. DB δεν έχει αλλάξει από το να κάνει αυτή την επιχείρηση. Έτσι, το τελικό βήμα είναι να συνδέσετε αυτό με ERDDAP™ , Δείχνω μόνο το μέρος που απαιτείται για να συνδεθεί με το αρχείο, όχι όλες τις μεταβλητές πληροφορίες:

```
<dataset type="EDDTableFromDatabase" datasetID="duckdb_test" active="true">
<!-- JDBC Connection Details -->
<sourceUrl>jdbc:duckdb:detects.db</sourceUrl>
<driverName>org.duckdb.DuckDBDriver</driverName>
<catalogName></catalogName>
<schemaName></schemaName>
<tableName>detects_table</tableName>
<columnNameQuotes></columnNameQuotes>
>
```

Και αυτό είναι το σύνολο δεδομένων σε ένα ERDDAP™ στο laptop μου χρησιμοποιώντας το βύσμα DuckDB:
