เนื้อหานี้ขึ้นอยู่กับ [ข้อความจากรอย เมนเดลสัน ERDDAP กลุ่มผู้ใช้](https://groups.google.com/g/erddap/c/JWoS_y3cygg/m/zCpcNTxNAAAJ) .

1. ปรับตั้งแฟ้ม Netcdf สําหรับกลุ่มเมฆ
ดัตช์)

A. แพ็คและขนาดหน้า

เมื่อ เร็ว ๆ นี้ ใน การ ค้นคว้า บาง เรื่อง ผม พบ บทความ ที่ น่า สนใจ เรื่อง นี้:

https://nsidc.github.io/cloud-optimized-icesat2/

ไม่มีสิ่งไหนดูเหมือนจะกระตุ้นความหลงใหล เช่น การอภิปรายภาษาโปรแกรม บรรณาธิการ และรูปแบบไฟล์ และนี่ไม่ใช่การแนะนํารูปแบบ (วินาที) คุณควรจะใช้ แต่เพื่อเข้าใจสิ่งที่อยู่ในกระดาษว่า และดูว่าการปรับปรุงสามารถ ( ERDDAP™ ได้พยายามเสมอที่จะ anognostic เกี่ยวกับจํานวนมากเหล่านี้แทนการเลือกที่จะพยายามและทํางานกับวิธีการจริงคนทํางานกับข้อมูล) .

กระดาษ นี้ ส่วน ใหญ่ จะ มุ่ง ไป ใน สถานการณ์ ที่ ข้อมูล ถูก เก็บ ไว้ ใน ที่ เก็บ ของ วัตถุ เช่น แอ มะ ซอน เอส 3. ร้านค้าวัตถุเข้าถึงผ่านเครือข่ายโดยใช้ http  (วินาที) คําสั่ง, ดังนั้นเปรียบเทียบกับการจัดเก็บ กับการเชื่อมต่อโดยตรงกับ (เสมือน) แม่ข่าย มีความล่าช้านานกว่ามาก ตามที่คําขอนั้น ต้องเดินทางไปรอบ ๆ สําหรับร้านวัตถุที่คุณต้องการจะทําให้มีการร้องขอน้อยเท่าที่เป็นไปได้ แต่ถ้าคุณเพียงแค่ทําให้การขออย่างมากเพื่อลดจํานวนการโทร คุณอาจจะเข้าถึงข้อมูลได้มากกว่าที่คุณต้องการ ดังนั้นกลเม็ดคือการทําสมดุล ระหว่างตัวประกอบสองตัวนี้ และ ถึง แม้ ว่า การ เข้า ถึง ข้อมูล ใน ร้าน ของ วัตถุ ต่าง ๆ ได้ รับ การ ปรับ ปรุง ให้ ดี ขึ้น มาก มาย ก็ ตาม ดัง นั้น จึง มี การ เข้า ไป เก็บ ของ ที่ ติด อยู่ โดย ตรง. ใน การ วิจัย เรื่อง นี้ มี การ กะ ประมาณ ว่า:

ดิสก์ท้องถิ่น:
• เวลาที่ต้องการ: 0.1 มม.
• 6 แสวง หา: 0.6 มม. (ไม่ อาจ ปฏิเสธ ได้) 
• การอ่านข้อมูลกํากับภาพที่กระจัดกระจายรวดเร็ว
เมฆ HTTP:
• ต้องการความล่าช้า: 100-0 มม.
• 6 คํา ขอ: 600-12.00 เมตร (ช้ามาก&#33;) 
• การร้องขอแต่ละรายการมีระยะเวลาเดินทางรอบเครือข่าย

สิ่งที่สองที่จะเข้าใจได้คือ netcdf4/hdf5 แฟ้มที่เก็บไว้เป็นท่อน ๆ และกลับมาอยู่ในหน้าต่างๆ ดังนั้นขนาดสัมพัทธ์ของแต่ละแฟ้มนี้ อาจมีผลกระทบต่อความเร็วในการเข้าถึงเมื่อเข้าถึงมาจากคลังวัตถุ และโดยปริยายแล้วข้อมูลกํากับภาพเกี่ยวกับแฟ้มจะกระจัดกระจายไปทั่วแฟ้ม ดังนั้น การได้ข้อมูลกํากับอาจจะใช้เวลาในการร้องขอ จุดหลักของกระดาษคือ ขนาดหน้ากระดาษปริยายสําหรับแฟ้ม netcdf4/hdf5 is 4096 bytes (4KB) - (ซึ่งน่ากลัวสําหรับเมฆ&#33;) เนื่องจากขนาดข้อมูลกํากับเท่านั้น ที่น่าจะมากกว่าอันนี้ และน่าจะมากกว่าขนาดชิ้นของคุณ ดังนั้นสารสกัดจะต้องเดินทางรอบที่ช้ามาก สิ่งที่คุณต้องการทําคือแพ็คแฟ้มใหม่ เพื่อให้ข้อมูลกํากับทั้งหมดอยู่ที่ “ด้านบน" ของไฟล์ และขนาดหน้าอย่างน้อยใหญ่เท่าขนาดข้อมูลกํากับภาพ บวกกับขนาดของชิ้นเดียว นอก จาก นี้ ยัง ไม่ ได้ กําหนด ขนาด ของ หน้า แต่ ใช้ ยุทธวิธี ที่ แตก ต่าง กัน ไป. สิ่ง ที่ กระดาษ พบ คือ การ ใช้ ขนาด หน้า ที่ กําหนด ไว้ ซึ่ง ก่อ ผล ดี กว่า.

ดังนั้นฉันจะกําหนดขนาดแฟ้มได้ อย่างไร?

> h5stat yourfile.nc | grep "File metadata" # metadata size
>

แล้วผมจะกําหนดขนาดก้อนได้อย่างไร

> h5dump -pH MUR41_file.nc | grep -A3 CHUNKED
>

หรือ

> ncdump -sh MUR41_file.nc | grep ChunkSizes
>

และผมจะกําหนดกลยุทธ์การขยายหน้าได้อย่างไร

> h5stat yourfile.nc | grep "File space management strategy"
>

มีแนวโน้มว่าคําสั่งนี้จะกลับมา "H5F_FPSPSPETEEGY_FSM_AGGGGA" ซึ่งเป็นกลยุทธ์ปริยาย และสิ่งที่เราต้องการให้มันกลับมาคือ "H5F_FSPROTED_STRREGEGYGEGY".

ผมจะแพ็คแฟ้ม Netcdf ใหม่ได้อย่างไร เพื่อให้ข้อมูลกํากับทั้งหมดอยู่ด้านหน้า และเปลี่ยนกลยุทธ์เพื่อให้มีการใช้งานหน้าคงที่ และขนาดหน้าไหนที่จะใช้? กฎของนิ้วโป้งที่ผมพบคือ

เลือกขนาดหน้ากระดาษ:
• ต้องมีขนาดแฟ้มกํากับรวม (วิกฤต&#33;) 
• ควรเป็นพลังของ 2 (4 MB 8 MB 16 MB ฯลฯ) 
• อย่าบ้าไปใหญ่ - 32 MB ปกติจะสูงสุดจริง
• ลอง คิด ถึง ขนาด ของ หน้า ชิ้น ส่วน ควร ใส่ ชิ้น ส่วน ที่ ใหญ่ ที่ สุด

ดัง ที่ กล่าว ข้าง ต้น ใน อุดมคติ แล้ว ขนาด ของ มัน ควร จะ ใหญ่ กว่า ขนาด ของ ข้อมูลกํากับภาพ รวม ทั้ง ขนาด ของ ชิ้น เดียว. การ ศึกษา วิจัย พบ ว่า สําหรับ ข้อมูล มาก มาย ขนาด หน้า 8MB เป็น การ แลก เปลี่ยน ที่ ดี อาจ มี ขนาด ใหญ่ กว่า ขนาด ข้อมูล ส่วน ตัว และ ไม่ ได้ ดึง ข้อมูล มาก กว่า ที่ คุณ ต้องการ. เพื่อให้เรื่องนี้สําเร็จ

H5reack - SS Page - G 8388608 แฟ้มของคุณ .nc เ_พิ่มแฟ้มของคุณ .nc 

นี่เป็นค่าที่จะใช้หาขนาดหน้ากระดาษที่แตกต่างกัน:

4194304 (4 MB) 
8388608 (8 MB) 
16777216 (16 MB) 
33554432 (32 MB) 

b. มี ประโยชน์ ไหม หาก ใช้ แฟ้ม ใน ท้อง ถิ่น ด้วย?

กระดาษและของอื่นๆที่ผมพบ แสดงให้เห็นว่า แม้แต่ในท้องถิ่น ก็สามารถเพิ่มความเร็ว จาก 10%-30% ได้ ในการทดสอบของผม ยกเว้นการทดสอบแบบเติมท่อ ผมพบว่าความเร็วประมาณ 10% เมื่อคําร้องขอนั้นค่อนข้างเล็ก เมื่อเทียบกับขนาดแฟ้มโดยรวม

c. TANTAAFL

อ่า แต่มันมีอะไรจับได้เยอะนะ นี่มันเหมือนอาหารกลางวันฟรี และจุดที่จับคือ ขนาดหน้าคงที่ เพิ่มขนาดของไฟล์ สําหรับบางคดีที่ผมพยายาม

617Mumber1 .nc 
632M mur1_opimized .nc 
608 Mur2 .nc 
616M mur2_ opimized .nc 
29M Chla1 .nc 
40Mchla1_opimized .nc 
30M Chla2 .nc 
40M Chla2_opimized .nc 

ดังนั้น การแลกเปลี่ยนก็คือ การเพิ่มขนาดแฟ้มไม่ได้เล็กน้อย

ดี. แต่ถ้าผมต้องประมวลเอกสารใหม่... ?

คําถามที่ดีคือ ถ้าผมต้องเขียนสคริปต์เพื่อประมวลไฟล์ใหม่ ทําไมไม่เพียงแค่เขียนสคริปต์เพื่อแปลเป็นรูปแบบเช่น sarr? ซาร์ มีผู้สนับสนุนมากมาย และถ้าคุณสนใจในซาร์ ก็แค่ทําการค้นหาแบบเป็ดเป็ดอย่างรวดเร็ว และมีโพสต์ดีๆมากมายhttps://www.youtube.com/watch?v=IEAcCmcOdJs  (มันน่าสนใจที่หลายจุดที่เขายกเป็น สิ่งที่รูปแบบของน้ําแข็งพยายามที่จะอยู่) . ดังนั้นทําไมคุณจึงไม่อยากแปลแฟ้มของคุณ ให้เป็นแฟ้มแบบ Sarr, ประการแรก, ถ้าคุณสร้างแฟ้ม Netcdf เป็นประจํา คุณสามารถเริ่มปรับแต่งแฟ้มต่อจากนี้, ERDDAP™ ยังสามารถที่จะรวมแฟ้มเข้าด้วยกันได้ แม้ว่าการตั้งค่าภายในบางตัวจะแตกต่างกันก็ตาม อย่างที่สอง คุณอาจมีเรื่องมากมายที่ขึ้นอยู่กับไฟล์ของ Netcdf และวิธีการนี้หมายความว่า จุด สําคัญ คือ การ ระวัง ทาง เลือก ต่าง ๆ และ เลือก ว่า จะ ใช้ อะไร ได้ ดี ที่ สุด สําหรับ สภาพ การณ์ ของ คุณ. เพื่อเป็นการเตือนความจํา หากคุณเลือกใช้แฟ้ม sar กับ ERDDAP™ พวกมันต้องเป็นแฟ้มแบบ Sarr แบบ v2

e ข้อมูลใหญ่ - ด้านข้าง

ข้อมูลใหญ่ถูกพูดถึงมาก แต่ข้อมูลที่คนส่วนใหญ่ใช้นั้นใหญ่ขนาดไหน และเทียบกับความสามารถของแล็ปท็อปสมัยใหม่ได้อย่างไร (ใช่ แล็ปท็อป ไม่ใช่เซิร์ฟเวอร์) . สิ่งที่น่าสนใจคือ

https://www.youtube.com/watch?v=GELhdezYmP0เริ่มรอบนาทีที่ 37 แม้ว่าการบรรยายทั้งหมดจะน่าสนใจ

งาน วิจัย ที่ เขา กล่าว ถึง คือ:

https://motherduck.com/blog/redshift-files-hunt-for-big-data/

ดังนั้น มีเปอร์เซ็นต์ที่ค่อนข้างน้อย ของผู้ใช้ที่ต้องการกระตุ้นพลังงาน แต่ผู้ใช้ส่วนใหญ่ สามารถทําการวิเคราะห์บนแล็ปท็อป บางอย่างที่ควรคิด

2. ใช้ ERDDAP™ กับ Google Cload Platsor หรือผู้ให้บริการเมฆอื่น ๆ นอกเหนือจาก AWS
-------------------------------------------------------------------------------------------------------------

ตอนนี้ ERDDAP™ เป็นที่ทราบกันว่า ทํางานกับร้านขายวัตถุ AWS เท่านั้น (ขนาด S3) แม้ว่าการปรับปรุงและการทั่วไป ERDDAP™ การ สนับสนุน จาก โรง เก็บ วัตถุ มี อยู่ ใน รายการ ของสิ่งที่จะทํา (ดูhttps://github.com/ERDDAP/erddap/issues/158) . แล้วจะทํายังไง ถ้ามีคนบอกว่าต้องวิ่ง ERDDAP™ บน Google Cload Platrid (แบบ GCP) หรือแพลตฟอร์มที่คล้ายกัน ข้อแรก,แพลตฟอร์มเมฆส่วนใหญ่มีระดับการจัดเก็บที่แตกต่างกัน โดยปกติแล้วมักรวมเข้ากับการจัดเก็บในท้องถิ่น (เข้าถึงโดยตรงโดย OS) และเป็นหนึ่งในร้านขายวัตถุ คําตอบแรกไม่ใช่ใช้ร้านขายวัตถุ และคุณไปได้ แต่เช่นเคย TANTAAFL และดึงกลับในกรณีนี้เป็นเช่นเดียวกับคุณไปจากร้านค้าวัตถุ -&gt; การเข้าร้าน NFS -&gt; ร้านค้าท้องถิ่นค่าใช้จ่ายของคุณยังเพิ่มขึ้น (ผมจะเพิ่มเข้าไปว่า NFS ยังเข้าถึงผ่านเครือข่าย และมีปัญหาเกี่ยวกับความล่าช้าของมันเอง) .

หากคุณจําเป็นต้องใช้ร้านค้าวัตถุ หรือสามารถจ่ายได้เฉพาะร้านค้าวัตถุ คําตอบคือระบบไฟล์ FUSE (https://github.com/libfuse/libfuse) . บน GCP นี้เรียกว่า gcsfuse และขั้นตอนในการติดตั้งคือ:

• ติดตั้ง gcsfuse บนอิมเมจของลินุกซ์ของคุณ:
sudo apt update
sudo apt ติดตั้ง gcsfuse
• กําหนด เขต งาน ให้ เป็น GCP (ถ้ายังไม่มีการตรวจสอบสิทธิ์) .
เพื่อให้แน่ใจว่าคุณมีสิทธิ์ในการตรวจสอบสิทธิ์ โดยปกติจะเป็นผ่านบัญชีผู้ใช้บริการ หรือมีการล็อกอินแบบใช้ gCRT
• เมานท์ถัง GCSS ไปยังไดเรกทอรีภายในระบบ:
เมานท์ถัง GCSS ของคุณไปยังไดเร็กทอรีภายในโดยใช้ gcsfuse นี่จะช่วยให้โปรแกรม GCP ของคุณ เข้าถึงข้อมูลได้ ประหนึ่งมันเป็นส่วนหนึ่งของระบบแฟ้มท้องถิ่น
gcsfuse ของคุณ- buget name / path/ to/ mount/ directory

และตอนนี้ร้านวัตถุของคุณ สามารถเข้าได้ เหมือนกับเป็นส่วนหนึ่งของระบบไฟล์ลินุกซ์ ERDDAP™ . นี่ดูเหมือนเวทมนตร์ การได้สิ่งที่ดีที่สุดของทั้งสองโลก มันต้องมีการจับ และมันมี ระบบไฟล์ FUSE ค่อนข้างจะช้ากว่าการเข้าถึงคลังวัตถุโดยตรง (โดยพื้นฐานแล้ว คุณได้เพิ่มชั้นอื่นเข้าไป) . ในงานวิจัยของผม ประมาณว่า มันช้าแค่ไหนในแผนที่ ผมเลยไม่รู้ว่าช้าลงแค่ไหน แต่ถ้าคุณอยู่ในสถานการณ์ที่คุณจะต้องทํางานบน GCP โดยใช้ร้านค้าวัตถุ, คุณมีคําตอบสําหรับตอนนี้ ERDDAP™ .

3. สิ่ง ที่ คุณ ทํา ได้ ใน ตอน นี้ เพื่อ ช่วย.
ต่าง ๆ-- - - - - - - - - - -

ถ้าคุณมีเวลาและความสามารถ ที่จะทดสอบบางอย่างเหล่านี้ และรายงานผลของคุณ นั่นคงจะเยี่ยมมาก โดยเฉพาะถ้าคุณเข้าถึง GCP หรือคล้ายกัน และดูว่าช้าลงแค่ไหน ERDDAP™ ใช้งาน FUSE (ที่จริงคุณสามารถทดสอบกับ AWS ได้เช่นกัน) . ถ้าการลงโทษความเร็วไม่ได้สูงเกินไป นั่นจะวิเศษมาก เพราะผมมีเหตุผลที่จะเชื่อว่า บางคนเร็ว ๆ นี้จะต้องดําเนินการของพวกเขา ERDDAP™ S on GCP กับร้านขายวัตถุ นี่จึงไม่ใช่แค่เรื่องที่น่าสนใจทางทฤษฎี
