เนื้อหานี้ขึ้นอยู่กับ [ข้อความจากรอย เมนเดลสัน ERDDAP กลุ่มผู้ใช้](https://groups.google.com/g/erddap/c/1U0OByOasu4/m/JM39reEsBAAJ) .

ความช่วยเหลือมากมายที่เราได้รับ ปัญหาเกี่ยวกับการใช้หน่วยความจําใน ERDDAP™ . บางส่วนของสิ่งนี้มาจากการเปลี่ยนแปลง ของการจัดการหน่วยความจําใน Java และยังมีปฏิสัมพันธ์กับการจัดการหน่วยความจําของลินุกซ์ OS เริ่มที่ผมเชื่อว่า Java 17 Java ใช้หน่วยความจํามากขึ้นกว่าสิ่งที่วางลงในการตั้งค่ากอง คุณจะเห็นนี่ หากคุณดูที่การตั้งค่ากองของคุณ แล้วใช้คําสั่งเช่นด้านบน, htop หรือ btop เพื่อตรวจสอบการใช้งานหน่วยความจําของโปรแกรม ตัวอย่าง: ERDDAP™ การใช้หน่วยความจําสามารถทํางานได้ 28GB-30GB บางครั้งสูงกว่า ค่านี้สามารถเพิ่มค่าได้ หากมีการร้องขอไปยังระบบจํานวนมากพร้อมกัน

ในระบบลินุกซ์ส่วนใหญ่ เมื่อการใช้งานหน่วยความจําได้รับมากกว่าประมาณ 50% OS จะเริ่มสลับหน่วยความจํา ยิ่ง กว่า นั้น สําหรับ ระบบ ส่วน ใหญ่ พื้นที่ แลก เปลี่ยน กัน จะ ไม่ ใช่ ขยะ ที่ ถูก เก็บ ไว้ จน กว่า จําเป็น อย่าง ยิ่ง ซึ่ง สําหรับ ERDDAP™ สายไปแล้ว และเป็นสาเหตุ ERDDAP™ เพื่อแช่แข็ง และพื้นที่สลับที่ช้า ซึ่งสําหรับขนาดใหญ่ datasets.xml อาจทําให้เกิดการปรับปรุงครั้งใหญ่ ที่ไม่เสร็จสมบูรณ์ ซึ่งต่อมาก็รวมปัญหาเข้าด้วยกัน

คุณทําอะไรได้บ้าง อย่างแรก หาการใช้งานหน่วยความจําที่แท้จริง หรือระบบของคุณ และมี RAM เพียงพอ เพื่อให้การใช้งานหน่วยความจํา ไม่เกิน 50% แต่ยังมีสองการตั้งค่าที่สามารถเปลี่ยนแปลงพฤติกรรมนี้ , vm. squappies และ vm.vfs_cache_pressure.

vm. swappiest ควบคุมวิธีการก้าวร้าวเคอร์เนลลินุกซ์ใช้พื้นที่แลกเปลี่ยน คุณสามารถตรวจสอบค่าปัจจุบันได้:

> cat /proc/sys/vm/swappiness
>
• ค่าปริยายคือ 60 (วัดจาก 0 ถึง 100) .
• ค่าที่ต่ํากว่าทําให้ระบบมีโอกาสน้อยลงในการสลับที่
• บ่อย ครั้ง มี การ ใช้ ค่า 10 หรือ 1 สําหรับ ระบบ ต่าง ๆ ที่ มี ม้า เป็น อัน มาก.


เพื่อเปลี่ยนค่าจนกว่ารีบูทบอก 10:

> sudo sysctl vm.swappiness=10
>

และเปลี่ยนอย่างถาวร

> sudo nano /etc/sysctl.conf
>

และแก้ไขค่าสําหรับ vm. swappy จากนั้นให้ปรับใช้การเปลี่ยนแปลง:

> sudo sysctl -p
>

vm.vfs_cache_pressment. บอกระบบวิธีการที่ก้าวร้าวในการเรียกความทรงจํากลับมา ค่าที่สูงกว่า (100 หรือมากกว่า) บอกระบบให้ก้าวร้าวมากขึ้น เพื่อตรวจสอบมูลค่าปัจจุบัน:

> cat /proc/sys/vm/vfs_cache_pressure
>

เพื่อเปลี่ยนค่าจนกระทั่งการเรียกใหม่ครั้งต่อไป:

> sudo sysctl vm.vfs_cache_pressure=150
>

เพื่อเปลี่ยนค่าอย่างถาวร:

> sudo nano /etc/sysctl.conf
>

และเพิ่มหรือปรับปรุงบรรทัด

> vm.vfs_cache_pressure = 100
>

แล้วใช้การเปลี่ยนแปลง:

> sudo sysctl -p
>


คุณจะทําอย่างไรถ้าคุณเฝ้าดูการใช้สเปซสลับที่ และคุณสังเกตว่าการใช้งานแลกเปลี่ยนนั้น เริ่มเพิ่มขึ้น? มีคําสั่งที่จะสลับช่องว่าง และย้ายเนื้อหาไปยังหน่วยความจํา ก่อนที่จะใช้นี้ คุณต้องแน่ใจว่าหน่วยความจําที่มีอยู่นั้นมีขนาดใหญ่กว่าการใช้งานแลกเปลี่ยน ดิฉันขอบอกว่า ความจําที่มีอยู่ เพราะในระบบลินุกซ์ที่มีการใช้งานดิสก์หนัก "ความทรงจําที่ฝังแน่น" สามารถค่อนข้างสูง ดังนั้น "ความทรงจําอิสระ" จะแสดงออกมาว่าต่ํามาก แต่ "ความทรงจําที่เจ็บปวด" จะทํางานถ้าจําเป็นสําหรับการสั่งซื้อเช่นนี้

> sudo swapoff -a && sudo swapon -a
>

เพื่อความแน่ใจ ผมชอบบังคับการเก็บขยะด้วย

> sudo jcmd $(pgrep java) GC.run
>

ฉันหวังว่าบางคน จะเห็นข้อมูลนี้เป็นประโยชน์ เราต้องการให้ ERDDAP™ แข็งแกร่งที่สุดเท่าที่เป็นไปได้ และทํางานอย่างไม่ลดละกับวิธีที่คนทํางานจริง
