このコンテンツは、 [Roy Mendelssohnからのメッセージ ERDDAP ユーザーグループ](https://groups.google.com/g/erddap/c/zZUt6PKfkoI/m/expZ3UkkBAAJ) お問い合わせ

最近ではAWS S3でファイルにアクセスしてもらいたいという質問がいくつかあります。 ERDDAP™ お問い合わせ まずは、 ERDDAP™ バージョン 2.29 は、AWS 以外のオブジェクトストアでも動作する S3 アクセスを改善しました。 (おかげでセス&#33;) お問い合わせ しかし、以前は、FUSE ベースのシステムを使用して S3 ストアをサーバーや VM のファイルシステムとして表示するようにしました。

これを行うための一つの方法は、"rclone" を使用します。 (https://rclone.org/) . rclone は多くの異なる S3 システムで動作します。, パフォーマンスを最適化するために、多くの異なる設定を持っています。, キャッシュ サイズの設定を含みます, うまくいけば、FUSE を実行から速度のペナルティの一部を相殺することができます. rclone の使用の利点 ERDDAP TM は、rclone が S3 とのやりとりを全て取り扱うので、データセット型は以下のような EDDGrid FromNcFiles はローカルファイルが存在するかのように直接使用できます。 これは、あなたのオブジェクトストアにアクセスするために、 rclone をセットアップする方法を把握する必要があることを意味し、残りの部分は単なる通常の Linux タイプのセットアップです。

今、私はちょうどそれでそれを残して、例を与えないなら、私は辞退します。 以下では匿名でマウントするつもりです NOAA Ubuntuサーバーの1つで公開アクセス可能なAWS S3ストアにあるGoes17データでは、初期設定では、すべてが機能していることを確認するために、rcloneプロセスがフォアグラウンドで実行され、その後、私はバックグラウンドで実行されているサービスにIIを回す方法について説明します。 以下では、キャッシュは1GBに設定されています。 キャッシュを大きくすることで、パフォーマンスが向上し、5GB-10GB 以上のものも増えます。 また、設定はパフォーマンスを最適化できるものの、最適なものではないかと推測しています。 ERDDAP™ お問い合わせ


1. 必要なソフトウェアをインストールします。
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

sudo aptアップデート
sudo apt インストール rclone fuse3 ログイン

2. 匿名S3リモートを作成する
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

rclone config は go17 s3 を作成します
プロバイダー AWS \\
地域 私たちイースト-1 \\
所在地_constraint us-east-1 \\
env_auth 偽 \\
匿名 真実

3. そのテスト。
———————

rclone lsd go17:noaa-goes17 | ヘッドヘッド

4. データのマウントポイントを作成する
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

sudo mkdir -p /mnt/goes17
sudo chown $USER:$USER /mnt/goes17

5. データのマウント (このプロセスはフォアグラウンドで実行されるので、出力がいくつか表示されます。) 
————————————

rclone -vv マウント go17:noaa-goes17 /mnt/goes17 \\
--read-only \\
--vfs-cache-mode フル \\
--vfs-cache-max-size 1G \\
--vfs-cache-poll-interval 1m \\
--vfs-read-chunk-size 64M \\
--vfs-read-chunk-size-limit 1G \\
--vfs-read-aheadの 256M \\
--バッファサイズ 64M \\
--dir-cache-time 24h \\
--attr-timeout 1s \\
--no-modtime ディレクティブ

6. サーバ上の新しいタブを開き、チェック
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

ls /mnt/goes17の特長 | ヘッドヘッド

7. データにアクセスできるか確認
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
cd /mnt/goes17/ABI-L1b-RadC/2023/010/15
ログイン ログイン OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c20230101541461 .nc 
```
netcdf OR_ABI-L1b-RadC-M6C16_G17_s20230101536138_e20230101536138_c20230101541461 {
dimensions:
y = 1500 ;
x = 2500 ;
number_of_time_bounds = 2 ;
band = 1 ;
number_of_image_bounds = 2 ;
num_star_looks = 24 ;
variables:
short Rad(y, x) ;
Rad:_FillValue = 1023s ;
Rad:long_name = "ABI L1b Radiances" ;
Rad:standard_name = "toa_outgoing_radiance_per_unit_wavenumber" ;
Rad:_Unsigned = "true" ;
Rad:sensor_band_bit_depth = 10b ;
Rad:valid_range = 0s, 1022s ;
Rad:scale_factor = 0.1760585f ;
Rad:add_offset = -5.2392f ;
Rad:units = "mW m-2 sr-1 (cm-1)-1" ;
Rad:resolution = "y: 0.000056 rad x: 0.000056 rad" ;
Rad:coordinates = "band_id band_wavelength t y x" ;
Rad:grid_mapping = "goes_imager_projection" ;
Rad:cell_methods = "t: point area: point" ;
Rad:ancillary_variables = "DQF" ;
.
.
.
.
```
世界最速のパイプを持っていないため、特に、結果は驚くほど迅速に返されました。

8. システムサービスを作る (ユーザー等に適した変更) : : :
—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

お問い合わせ システム単位を作成します。

sudoナノ/etc/systemd/system/rclone-goes17.service

そして入って下さい:

[ユニット]
説明=GOES17パブリックS3のためのRcloneマウント
After=networkオンライン .tar お問い合わせ

[サービス]
タイプ=シンプル
ユーザー=ubuntu
ExecStart=/usr/bin/rclone マウント go17:noaa-goes17 /mnt/goes17 \\
--read-only \\
--vfs-cache-mode フル \\
--vfs-cache-max-size 1G \\
--vfs-cache-poll-interval 1m \\
--vfs-read-chunk-size 64M \\
--vfs-read-chunk-size-limit 1G \\
--vfs-read-aheadの 256M \\
--バッファサイズ 64M \\
--dir-cache-time 24h \\
--attr-timeout 1s \\
--no-modtime なし
--s3-ノーチェックバック
ExecStop=/bin/fusermount3 -u /mnt/goes17
リスタート=常に
リスタートSec=10

[インストール]
WantedBy=マルチユーザ .tar お問い合わせ

. . サービスの有効化と開始:

sudo systemctlデーモンリロード
sudo systemctl --now rclone-goes17 を有効にします。

ツイート テスト

systemctlステータス rclone-goes17
ls /mnt/goes17の特長 | ヘッドヘッド



うまくいけば、これは人々に利用されるでしょう。 Google Cloud Platform の gcsfuse を使用して、階層的な名前空間を成功させる Bucket でテストしています。 rcloneの1つの利点 (ベンダー固有のものではないことに加えて) パフォーマンスを最適化するための設定が増えています。 ローカルを移動する場合は特に ERDDAP™ クラウドでは、ほぼシームレスに移行できます。
