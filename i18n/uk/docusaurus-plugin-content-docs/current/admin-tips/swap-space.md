Цей вміст ґрунтується на [повідомлення від Roy Mendelssohn до ERDDAP група користувачів](https://groups.google.com/g/erddap/c/1U0OByOasu4/m/JM39reEsBAAJ) й

Багато запитів на допомогу ми залучаємо проблеми з використанням пам'яті ERDDAP™ й Деякі з цих змін в управлінні пам'яттю Java , а також взаємодії з керуванням пам'яті Linux OS. Я вірю в Java 17.12.18 р. Java використовується більше пам'яті, ніж те, що вставляється в налаштуваннях. Ви можете побачити це, якщо ви подивитеся на налаштування вашого поштового відділення, а потім використовувати команди, такі як верхня, htop або btop, щоб перевірити використання пам'яті додатків. Так, наприклад, наш сильно використовується ERDDAP™ має простір для запису на 21GB, але насправді використання пам'яті може працювати до 28GB-30GB, іноді вище. Це значення може спіймати, якщо є багато одночасних великих запитів до системи.

На більшості Linux-систем, один раз використання пам'яті надходить близько 50%, ОС почне відключати пам'ять. Більш того, для більшості систем ковпачого простору не збираються сміття до абсолютно необхідного, що для ERDDAP™ є занадто пізно, і може викликати ERDDAP™ замерзнути. І клаптий простір повільний, який для великих datasets.xml може викликати великі оновлення, які потім з'єднують проблеми.

Що можна зробити про це. По-перше, з'ясуйте справжню пам'ять або вашу систему, і достатньо оперативної пам'яті, щоб використання пам'яті не перевищує 50%. Але є також два налаштування, які можуть змінити цю поведінку, vm.swappiness. і vm.vfs_cache_pressure.

vm.swappiness контролює, як агресивно ядро Linux використовує простір swap. Ви можете перевірити поточну вартість:

> cat /proc/sys/vm/swappiness
>
• За замовчуванням зазвичай 60 (від 0 до 100) й
• Низькі значення роблять систему менш ймовірним для заковтання.
• Часто використовується для систем з великою кількістю оперативної пам'яті.


Щоб змінити значення до перезавантаження, скажіть до 10:

> sudo sysctl vm.swappiness=10
>

І постійно міняти:

> sudo nano /etc/sysctl.conf
>

І відредагувати значення для vm.swappiness. Потім нанести зміни:

> sudo sysctl -p
>

vm.vfs_cache_pressure. розповідає про те, як агресивно бути в регуляції пам'яті. Вищі значення. (100 або більше) Розкажіть систему більш агресивною, щоб перевірити наявне значення:

> cat /proc/sys/vm/vfs_cache_pressure
>

Щоб змінити значення до наступного перезавантаження:

> sudo sysctl vm.vfs_cache_pressure=150
>

Щоб змінити значення постійно:

> sudo nano /etc/sysctl.conf
>

А потім додати або оновити рядок:

> vm.vfs_cache_pressure = 100
>

А потім застосуйте зміни:

> sudo sysctl -p
>


Що ви можете зробити, якщо ви контролюєте використання клаптів, і ви помітили, що використання клапта починає збільшуватися? Існує команда, яка буде порожній поворотний простір і перемістить вміст пам'яті. Перед тим як використовувати це, потрібно зробити певну, яка доступна пам'ять більше, ніж використання клаптів. Я скажу, що доступна пам'яті, оскільки в Linux-системах з використанням важкого диску «закрита пам'ять» може бути досить високою, тому «безкоштовна пам'ять» покаже як дуже низька, але «збиток пам'яті» буде здійснено, якщо це потрібно для команд.

> sudo swapoff -a && sudo swapon -a
>

Просто бути певним Я хотів би змусити сміття також після цього:

> sudo jcmd $(pgrep java) GC.run
>

І я сподіваюся, що деякі люди знаходять цю інформацію корисною. Ми хочемо зробити ERDDAP™ якнайшвидше, так і для роботи, як це можливо, так і для того, як люди насправді працюють.
