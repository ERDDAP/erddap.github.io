이 콘텐츠는 [로이 Mendelssohn의 메시지 ERDDAP 사용자 그룹](https://groups.google.com/g/erddap/c/JWoS_y3cygg/m/zCpcNTxNAAAJ) ·

1. 클라우드에 최적화된 netcdf 파일
———————————————

a. 재 포장 및 페이지 크기

최근 몇 가지 연구에 나는이 매우 흥미로운 기사를 통해 온:

https://nsidc.github.io/cloud-optimized-icesat2/

프로그래밍 언어, 편집자 및 파일 형식의 토론과 같은 인화 열정과는 달리이 형식의 권고는 아닙니다. (₢ 킹) 당신은 사용해야합니다, 그러나 오히려 그 종이에 어떤 것이 무엇인지 이해하고 얼마나 많은 개선이 gotten 할 수 있는지 ( ERDDAP™ 이 문제의 많은 것에 대해 항상 임신하려고, 오히려 시도하고 데이터와 어떻게 작업하는지 선택) ·

종이는 주로 Amazon S3와 같은 객체 저장소에 저장되는 상황을 대상으로합니다. Object store는 네트워크를 통해 접근 http  (₢ 킹) 명령, 그래서 직접 연결과 스토리지에 비해 (한국어) 서버, 요청으로 훨씬 더 늦게 대기 시간이 있습니다. 객체 저장을 위해 가능한 한 몇 가지 요청으로 만들려면, 하지만 만약 당신이 정말 큰 요청을 적은 통화의 번호를 만들려면, 당신은 당신이 필요로하는 것보다 더 많은 데이터를 액세스 할 수 있습니다, 더 이상 그렇게 느릴 수 있습니다. 그래서 트릭은이 두 가지 요소 사이의 균형을 달성하는 것입니다. 객체 저장소에 데이터에 액세스 할 수 있지만 매우 개선되었으므로 직접 첨부 된 저장소에 액세스 할 수 있습니다. 이 몇몇 추정치는 연구에서:

로컬 디스크:
· 시크 시간: 0.1ms
• 6 추구 : 0.6ms (이름 *) 
· 읽음 scattered metadata는 빠릅니다
클라우드 HTTP:
· 요구 대기시간: 100-200ms
• 6개의 요구: 600-1200ms (아주 느리다&#33;) 
· 각 요구에는 네트워크 왕복 시간 있습니다

이해하는 두 번째 것은 netcdf4/hdf5 파일이 펑크에 저장되어 페이지에 반환되므로 액세스 할 때 액세스 속도에 실제로 영향을 줄 수 있으므로 파일에 대한 메타 데이터가 파일 전체에 흩어져 있으므로 메타 데이터가 여러 요청을 취할 수 있습니다. 종이의 주요 점은 netcdf4/hdf5 파일의 기본 페이지 크기는 4096 바이트입니다. (4KB) - - - (구름에 대한 끔찍한&#33;) metadata 크기가 혼자서 이보다 더 큰 것이기 때문에 당신의 펑크 크기가 더 큰 것입니다. 그래서 추출물은 느리다 많은 왕복이 필요합니다. 당신이해야 할 일은 파일을 다시 포장하기 때문에 모든 메타 데이터는 파일의 "top"에 있으며 페이지 크기는 메타 데이터 크기와 하나의 펑크의 크기만큼 커다란 것입니다. 기본적으로 페이지 크기는 고정되지 않지만, 변화하는 전략을 사용합니다. 검색 결과를 찾을 수 없음 한국어 사전에

그래서 나는 파일 메타 데이터 크기를 결정할 수 있습니까?

> h5stat yourfile.nc | grep "File metadata" # metadata size
>

그리고 어떻게 펑크 크기를 결정할 수 있습니다:

> h5dump -pH MUR41_file.nc | grep -A3 CHUNKED
>

또는

> ncdump -sh MUR41_file.nc | grep ChunkSizes
>

그리고 어떻게 페이지를 결정 전략:

> h5stat yourfile.nc | grep "File space management strategy"
>

대부분의 경우이 명령은 기본 전략 인 "H5F_FSPACE_STRATEGY_FSM_AGGR"를 반환하고 우리가 반환하려는 것은 "H5F_FSPACE_STRATEGY_PAGE"입니다.

어떻게 내 netcdf 파일을 다시 포장 할 수 있도록 모든 메타 데이터가 전면에 있고, 조정 페이지 크기가 사용되었는지, 어떤 페이지 크기 사용? 내가 발견 된 엄지의 규칙 :

페이지 크기 선택:
· 이어야 합니다 ≥ 총 파일 metadata 크기 (중요&#33;) 
· 2의 힘이어야 합니다 (4MB, 8MB, 16MB, 등) 
· 큰 이동하지 마십시오 - 32MB는 보통 실제 최대입니다
· chunk 크기 고려 - 페이지 크기는 최대의 펑크를 수용해야합니다

위에서 말했듯이, 이상적으로 크기는 메타 데이터 크기와 하나의 펑크의 크기보다 커야합니다. 발견 된 연구는 많은 데이터 세트에 대한 것입니다 8MB 페이지 크기는 좋은 거래, 그것은 아마 더 큰 메타 데이터 크기 + 펑크 크기, 당신이 필요로하는 것보다 더 많은 데이터를 끌어 들지 않습니다. 이 작업을 수행:

h5repack -S PAGE -G 8388608 파일 .nc 파일 형식 .nc 

다른 페이지 크기를 얻기 위해 사용하는 값은 다음과 같습니다.

4194304의 (4MB 이상) 
전화기:+86-21-666666888 팩스:+86-21-666888 (8MB 이상) 
전화기:+86-21-666666666 팩스:+86-21-666688 (16MB 이상) 
전화 번호: +33 (0) 236 332 (32MB 이상) 

₢ 킹 로컬로 파일을 사용하는 경우 이점이 있습니까?

내가 발견 한 종이와 다른 것들은 지역적으로 10 % ~ 30 %의 속도로 얻을 수 있다는 것을 제안합니다. 내 아무것도하지만 철저한 테스트에서 나는 요청이 전반적인 파일 크기에 비해 상대적으로 작을 때 약 10 %의 속도 증가를 발견했지만, 요청이 더 크지 만 느리게 발견되지 않았습니다.

· 사이트맵

아이지만 어딘가에 붙잡는 것은 무료 점심처럼 보입니다. 그리고 캐치는 고정 페이지 크기가 파일의 크기를 증가한다는 것입니다. 어떤 경우 나는 시도 :

617만 mur1 .nc 
632M의 mur1_optimized .nc 
608만 mur2 .nc 
616M mur2_ 최적화 .nc 
29M 킬 1 .nc 
40M chla1_ 최적화 .nc 
30M 킬라2 .nc 
40M chla2_ 최적화 .nc 

그래서 tradeoff는 파일 크기에 불문 증가가 없습니다.

₢ 킹 그러나 나는 어떤 파일을 처리해야 ... ...?

좋은 질문은 파일을 재 처리하기 위해 스크립트를 작성해야 하는 경우, 왜 그냥 zarr 같은 형식으로 번역 할 스크립트를 작성하지? zarr은 많은 proponents을 가지고 있으며 zarr에 관심이 있다면 빠른 Duckduckgo 검색을하고 많은 좋은 게시물이 있습니다. 아마도 더 균형 잡힌 전망은https://www.youtube.com/watch?v=IEAcCmcOdJs  (점의 많은 점이 제기하는 것은 얼음 펑크 형식이 주소하려고하는 것) · 그래서 왜 zarr과 같은 무언가에 파일을 변환 할 수 없습니다, 먼저, 당신은 netcdf 파일을 정기적으로 만들 경우, 당신은 지금에서 파일을 최적화 시작할 수 있습니다, 시간이 초과 속도 이득을 볼 수 있으며, 당신은 과거 파일을 포맷 할 필요가 없습니다, 그리고 ERDDAP™ 내부 설정의 일부가 다르더라도 파일을 계속 구성 할 수 있습니다. 두 번째, 당신은 netcdf 파일에 따라 많은 툴링이있을 수 있습니다, 그리고이 접근은 코드의 광대 한 금액이 될 수있는 것을 재구성하지 않는다. 포인트는 옵션의 인식이되고 당신의 상황에 가장 적합한 것을 선택하십시오. 그냥 알림으로, 당신은 zarr 파일을 사용하려는 경우 ERDDAP™ , 그들은 zarr 형식 v2 파일이어야한다.

이름 * 큰 데이터 - aside

큰 데이터는 많은 것에 대해 이야기하지만, 얼마나 큰 데이터는 대부분의 사람들이 사용하는 방법과 현대 노트북의 기능과 비교하는 방법 (예 노트북, 서버가 없습니다) · 흥미로운 일이:

https://www.youtube.com/watch?v=GELhdezYmP0주위에 시작 37 전체 대화는 흥미로운

그가 언급 한 연구는 다음과 같습니다.

https://motherduck.com/blog/redshift-files-hunt-for-big-data/

따라서 실제로 힘을 크랭크 할 필요가있는 사용자의 상대적으로 작은 비율이 있지만, 사용자의 압도적 인 대다수는 노트북에 분석 할 수 있습니다, 26TB 외부 드라이브는 지금 $ 300 이하이고 rumors는 60TB 외부 드라이브가 1 년 말까지 사용할 수 있다는 것입니다. 생각할 것.

2. 사용 방법 ERDDAP™ AWS 외에 Google Cloud Platform 또는 기타 클라우드 제공업체
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

현재 위치 ERDDAP™ AWS 객체 저장소에서만 작동 (사이트맵) , 개선 및 종합 ERDDAP™ ’s object store support는 todo list에 있습니다. (이름 *https://github.com/ERDDAP/erddap/issues/158) · 그래서 당신이 당신의 실행해야하는 경우 무엇을해야 ERDDAP™ Google Cloud 플랫폼에서 (사이트맵) 또는 유사한 플랫폼? 첫째, 대부분의 클라우드 플랫폼은 로컬 스토리지와 유사하고 운영 체제에 의해 인식되고, 일반적으로 NFS를 사용하여 네트워크에 연결되는 하나에 의해 액세스 (OS에 직접 접근) , 그리고 객체 저장소 중 하나입니다. 첫번째 해결책은 객체 상점을 이용하지 않으며, 당신은 갈 것이다 좋을 것입니다. 그러나 항상 TANSTAAFL과이 경우의 단점은 객체 저장소 -&gt; NFS 액세스 -&gt; 로컬 저장소도 이동. (NFS는 네트워크에 액세스하고 자체 대기 시간 문제가 있음을 추가 할 것입니다. 또한 파일 최적화에서 혜택을 누릴 수 있습니다.) ·

오브젝트 저장을 사용해야 하는 경우, 또는 객체 저장소만 감당할 수 있습니다. 응답은 FUSE 파일 시스템입니다. (https://github.com/libfuse/libfuse) · GCP에서, 이것은 gcsfuse라고하며, 설치 단계는 다음과 같습니다.

• GCP Linux 이미지에 gcsfuse 설치:
sudo apt 업데이트
sudo apt 설치 gcsfuse
• GCP 인증 (이미 인증되지 않은 경우) ::
서비스 계정 또는 gcloud auth 로그인을 실행하여 올바른 자격 증명이 있는지 확인하십시오.
· 로컬 디렉토리에 GCS 버킷을 마운트:
GCS Bucket을 gcsfuse를 사용하여 로컬 디렉토리에 마운트하십시오. GCP 인스턴스를 사용하여 로컬 파일 시스템의 일부인 경우 데이터를 액세스할 수 있습니다.
gcsfuse your-bucket-name /path/to/mount/directory

그리고 이제 오브젝트 저장소는 Linux 파일 시스템의 일부이므로 액세스 할 수 있습니다. ERDDAP™ · 이것은 마법처럼 보인다, 두 세계의 최고를 얻고, 거기는 잡을해야합니다. 그리고 있다. FUSE 파일 시스템은 객체 저장소에 접근하는 것보다 좋은 비트 느리게 (기본적으로 당신은 접근에 또 다른 층을 추가) · 내 연구의 추정은 얼마나 느리게 모든지도를 통해, 그래서 나는 매우 느리게 얼마나 생각이 없다. 그러나 당신이 객체 저장을 사용하여 GCP에서 실행해야하는 상황에서있는 경우, 당신은 지금과 함께 작동 할 수있는 솔루션을 가지고 ERDDAP™ ·

3. 당신을 도울 수 있습니다.
———————————————————

당신이 시간과 능력이 이러한 것들을 테스트하고 결과에 다시보고하는 경우, 그것은 훌륭합니다. 특히 GCP 또는 유사하게 접근하고 얼마나 느리게 볼 경우 ERDDAP™ 액세스는 FUSE를 사용 (실제로 AWS에서도 이것을 테스트할 수 있습니다.) · 속도 벌금이 너무 크지 않다면, 나는 어떤 사람들을 믿는 이유가 곧 실행해야하기 때문에 훌륭합니다. ERDDAP™ 객체 저장소를 가진 GCP에 s. 그래서 이것은 이론적 인 관심의 문제입니다.
