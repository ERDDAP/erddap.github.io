यह सामग्री एक पर आधारित है [Roy Mendelssohn से संदेश ERDDAP उपयोगकर्ता समूह](https://groups.google.com/g/erddap/c/JWoS_y3cygg/m/zCpcNTxNAAAJ) ।

1. बादल के लिए netcdf फ़ाइलों का अनुकूलन
---------------

A. repacking and page size

हाल ही में कुछ शोध करने में मैं इस लेख में आया हूँ:

https://nsidc.github.io/cloud-optimized-icesat2/

कुछ भी नहीं लगता है कि प्रोग्रामिंग भाषाओं, संपादकों और फ़ाइल प्रारूपों की चर्चा जैसी कोई जुनून नहीं है, और यह किस प्रारूप की सिफारिश नहीं है (s) आपको इसका उपयोग करना चाहिए, बल्कि यह समझने के लिए कि उस पेपर में क्या है और यह देखने के लिए कि कितना सुधार हो सकता है ( ERDDAP™ हमेशा इन मामलों के बारे में जागरूक होने की कोशिश की है, बल्कि कोशिश करने और काम करने का विकल्प है कि लोग वास्तव में डेटा के साथ कैसे काम करते हैं।) ।

पेपर मुख्य रूप से उन स्थितियों के उद्देश्य से होता है जहां डेटा को ऑब्जेक्ट स्टोर जैसे Amazon S3 में संग्रहीत किया जाता है। ऑब्जेक्ट स्टोर का उपयोग करके नेटवर्क पर एक्सेस किया जाता है http  (s) आदेशों की तुलना में भंडारण के लिए सीधे कनेक्शन के साथ (आभासी) सर्वर, बहुत लंबे समय तक विलंबता है क्योंकि अनुरोध को राउंड ट्रिप करना पड़ता है। ऑब्जेक्ट स्टोर के लिए आप जितना संभव हो उतना ही अनुरोध करना चाहते हैं, लेकिन यदि आप कॉल की संख्या को कम करने के लिए वास्तव में बड़े अनुरोध करते हैं, तो आप अपनी आवश्यकता से अधिक डेटा तक पहुंच सकते हैं, जो कि अधिक नहीं होने पर समान रूप से धीमा हो सकता है। इसलिए चाल इन दो कारकों के बीच संतुलन हासिल करना है। हालांकि ऑब्जेक्ट स्टोर पर डेटा तक पहुंच में काफी सुधार हुआ है, इसलिए सीधे संलग्न भंडारण तक पहुंच है। इस शोध में कुछ अनुमान हैं:

स्थानीय डिस्क:
• समय देखें: 0.1ms
• 6 चाहता है: 0.6ms (नगण्य) 
• पढ़ना बिखरे मेटाडाटा तेजी से है
क्लाउड HTTP:
• 100-200ms
• 6 अनुरोध: 600-1200ms (बहुत धीमी&#33;) 
• प्रत्येक अनुरोध में नेटवर्क राउंड ट्रिप टाइम होता है

समझने की दूसरी बात यह है कि netcdf4/hdf5 फ़ाइलों को चंकने में संग्रहीत किया जाता है और पृष्ठों में वापस आ जाता है, इसलिए इनमें से प्रत्येक का सापेक्ष आकार वास्तव में एक्सेस स्पीड को प्रभावित कर सकता है जब एक्सेस एक ऑब्जेक्ट स्टोर से होता है, और डिफ़ॉल्ट रूप से फाइल के बारे में मेटाडाटा पूरे फाइल में बिखर जाता है, इसलिए मेटाडाटा कई अनुरोध ले सकता है। कागज का मुख्य बिंदु यह है कि netcdf4/hdf5 फ़ाइलों के लिए डिफ़ॉल्ट पृष्ठ का आकार 4096 बाइट्स है। (4KB) - (जो बादल के लिए भयानक है&#33;) चूंकि अकेले मेटाडाटा का आकार इस से काफी बड़ा है और इससे भी अधिक संभावना है कि आपके चंक आकार भी इससे अधिक बड़े हैं। इसलिए एक उद्धरण के लिए बहुत सारे राउंड-ट्रिप्स की आवश्यकता होगी जो धीमी है। आप क्या करना चाहते हैं, वह फ़ाइल को फिर से पैक कर रहा है ताकि सभी मेटाडाटा फ़ाइल के "शीर्ष" पर हो, और यह पृष्ठ का आकार कम से कम मेटाडाटा आकार के रूप में बड़ा है, साथ ही एक हिस्से का आकार भी है। इसके अलावा डिफ़ॉल्ट रूप से पृष्ठ का आकार निर्धारित नहीं है, लेकिन एक रणनीति का उपयोग करता है जो बदलता है। क्या पाया गया कागज एक निश्चित पृष्ठ आकार बेहतर परिणाम उत्पन्न का उपयोग कर रहा है।

मैं फ़ाइल मेटाडाटा आकार कैसे निर्धारित कर सकता हूं?

> h5stat yourfile.nc | grep "File metadata" # metadata size
>

और मैं कैसे चंकी आकार का निर्धारण कर सकता हूँ:

> h5dump -pH MUR41_file.nc | grep -A3 CHUNKED
>

या

> ncdump -sh MUR41_file.nc | grep ChunkSizes
>

और मैं पृष्ठ आकार देने की रणनीति कैसे निर्धारित कर सकता हूं:

> h5stat yourfile.nc | grep "File space management strategy"
>

सबसे अधिक संभावना यह कमांड "H5F_FSPACE_STRATEGY_FSM_AGGR" को वापस कर देगा जो डिफ़ॉल्ट रणनीति है और हम क्या चाहते हैं कि यह "H5F_FSPACE_STRATEGY_PAGE" है।

मैं अपनी netcdf फ़ाइल को कैसे रीपैक कर सकता हूं ताकि सभी मेटाडाटा सामने हो और रणनीति को बदल दें ताकि एक निश्चित पृष्ठ का आकार इस्तेमाल किया जा सके, और किस पृष्ठ का आकार उपयोग किया जा सके? मैं पाया अंगूठे के नियम हैं:

पृष्ठ आकार चयन:
• होना चाहिए ≥ कुल फ़ाइल मेटाडाटा आकार (महत्वपूर्ण&#33;) 
• 2 की शक्ति होना चाहिए (4MB, 8MB, 16MB, आदि।) 
• पागल मत जाओ - 32MB आमतौर पर व्यावहारिक अधिकतम है
• चंक आकार पर विचार करें - पृष्ठ का आकार सबसे बड़े चंकों को समायोजित करना चाहिए

जैसा कि ऊपर कहा गया है, आदर्श रूप से आकार मेटाडाटा आकार से अधिक होना चाहिए, साथ ही एक हिस्से का आकार भी होना चाहिए। क्या अध्ययन पाया जाता है कि बहुत सारे डेटासेट के लिए 8MB पेज का आकार एक अच्छा ट्रेडऑफ़ है, यह शायद मेटाडाटा आकार + चंक आकार से बड़ा है, और आपको आवश्यकता से ज्यादा डेटा नहीं खींचता है। इसे पूरा करने के लिए:

H5repack -S PAGE -G 8388608 yourfile .nc yourfile_optimized .nc 

यहाँ विभिन्न पृष्ठ आकार प्राप्त करने के लिए उपयोग करने के लिए मान हैं:

4194304 (4MB) 
838608 (8MB) 
1677216 (16MB) 
33554432 (32MB) 

b. यदि स्थानीय रूप से फ़ाइलों का उपयोग किया जाता है तो क्या लाभ होता है?

मैंने पाया है कि स्थानीय तौर पर वहाँ भी 10% -30% से कहीं अधिक गति लाभ हो सकता है। मेरी कुछ भी लेकिन एक्स्हॉसिव परीक्षणों में मुझे लगभग 10% की गति लाभ मिला जब अनुरोध समग्र फ़ाइल आकार की तुलना में अपेक्षाकृत छोटा होता है, और अनुरोध के रूप में गति में वृद्धि कम हो जाती है, लेकिन मुझे कभी भी इसे धीमा नहीं मिला।

c. TANSTAAFL

लेकिन कहीं भी एक कैच हो सकता है, यह एक मुफ्त दोपहर के भोजन की तरह लगता है। और पकड़ यह है कि निश्चित पृष्ठ का आकार फ़ाइल के आकार को बढ़ाता है। कुछ मामलों के लिए मैंने कोशिश की:

617M mur1 .nc 
632M mur1_optimized .nc 
608M mur2 .nc 
616M mur2_optimized .nc 
29M chla1 .nc 
40M chla1_optimized .nc 
30M chla2 .nc 
40M chla2_optimized .nc 

इसलिए ट्रेडऑफ़ फाइल के आकार में उल्लेखनीय वृद्धि नहीं है।

d. लेकिन अगर मुझे किसी भी तरह की फ़ाइलों को फिर से संसाधित करना है ...?

यदि मुझे फ़ाइलों को फिर से संसाधित करने के लिए एक स्क्रिप्ट लिखने की आवश्यकता है, तो क्यों न केवल एक स्क्रिप्ट को एक प्रारूप में अनुवाद करने के लिए लिखा जाए जैसे कि zarr? Zarr कई proponents है और यदि आप zarr में रुचि रखते हैं तो सिर्फ एक त्वरित duckduckgo खोज करें और वहाँ बहुत सारे अच्छे पोस्ट हैं, शायद अधिक संतुलित दृष्टिकोण पर हैhttps://www.youtube.com/watch?v=IEAcCmcOdJs  (यह दिलचस्प है कि जिन बिंदुओं को वह उठाता है उनमें से कई आइसचंक प्रारूप को संबोधित करने की कोशिश कर रहे हैं।) । इसलिए आप अपनी फ़ाइलों को ज़ार, फर्स्ट जैसी किसी चीज में क्यों परिवर्तित नहीं करना चाहते हैं, अगर आप नियमित रूप से netcdf फाइलें बनाते हैं, तो आप अब से फ़ाइलों को ऑप्टिमाइज़ करना शुरू कर सकते हैं, जो समय के साथ गति लाभ देखेंगे और आपको पिछली फ़ाइलों को सुधारने की आवश्यकता नहीं होगी। ERDDAP™ हालांकि कुछ आंतरिक सेटिंग्स अलग हैं, अभी भी फ़ाइलों पर एकत्रित करने में सक्षम होंगे। दूसरा, आपके पास बहुत सारे टूलिंग हो सकते हैं जो netcdf फ़ाइलों पर निर्भर करता है, और इस दृष्टिकोण का मतलब यह नहीं होगा कि कोड की एक व्यापक राशि क्या हो सकती है। बिंदु विकल्पों के बारे में जागरूक होना चाहिए और अपनी स्थिति के लिए क्या सबसे अच्छा काम करता है? एक अनुस्मारक के रूप में, यदि आप zarr फ़ाइलों का उपयोग करना चुनते हैं ERDDAP™ , वे zarr प्रारूप v2 फ़ाइलों होना चाहिए।

E. बिग डेटा - एक तरफ

बिग डेटा बहुत कुछ के बारे में बात की जाती है, लेकिन कितना बड़ा डेटा है जो अधिकांश लोग उपयोग करते हैं और कैसे आधुनिक लैपटॉप की क्षमताओं के साथ तुलना करते हैं। (हाँ लैपटॉप, सर्वर नहीं) । एक दिलचस्प टेक है:

https://www.youtube.com/watch?v=GELhdezYmP037 मिनट के आसपास शुरू करें हालांकि पूरी बात दिलचस्प है

वह अध्ययन उस पर है:

https://motherduck.com/blog/redshift-files-hunt-for-big-data/

इसलिए उन उपयोगकर्ताओं का एक अपेक्षाकृत छोटा प्रतिशत है जिन्हें वास्तव में सत्ता को क्रैंक करने की आवश्यकता है, लेकिन उपयोगकर्ताओं के भारी बहुमत लैपटॉप पर उनका विश्लेषण कर सकते हैं, 26TB बाहरी ड्राइव अब $300 से कम हैं और अफवाहें हैं कि 60TB बाहरी ड्राइव साल के अंत तक उपलब्ध होंगे। कुछ के बारे में सोचने के लिए।

2. उपयोग ERDDAP™ AWS के अलावा Google क्लाउड प्लेटफॉर्म या अन्य क्लाउड प्रदाताओं के साथ
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

पल ERDDAP™ केवल AWS ऑब्जेक्ट स्टोर के साथ काम करने के लिए जाना जाता है (S3) हालांकि सुधार और सामान्यीकरण ERDDAP™ ऑब्जेक्ट स्टोर समर्थन टोडो सूची में है (देखेंhttps://github.com/ERDDAP/erddap/issues/158) । यदि आप कह रहे हैं तो क्या करना चाहिए? ERDDAP™ Google क्लाउड प्लेटफॉर्म पर (जीसीपी) या इसी तरह के मंच? सबसे पहले, अधिकांश क्लाउड प्लेटफॉर्म भंडारण के विभिन्न स्तरों की पेशकश करते हैं, आमतौर पर एक सहित जो स्थानीय भंडारण के समान होता है और ऑपरेटिंग सिस्टम द्वारा मान्यता प्राप्त होती है, जो आमतौर पर नेटवर्क से जुड़ा होता है। (फिर से ओएस द्वारा सीधे सुलभ) , और एक है कि एक वस्तु की दुकान है। पहला समाधान ऑब्जेक्ट स्टोर का उपयोग नहीं करना है, और आप जाने के लिए अच्छा होगा। लेकिन हमेशा के रूप में, TANSTAAFL और इस मामले में वापसी के रूप में आप ऑब्जेक्ट स्टोर से जाना है -&gt; एनएफएस एक्सेस -&gt; स्थानीय स्टोर आपकी लागत भी बढ़ जाती है। (मैं यह कहूंगा कि एनएफएस नेटवर्क पर भी पहुंची है, और इसके अपने विलंबता मुद्दे हैं, यह फ़ाइल अनुकूलन से भी लाभान्वित होगा।) ।

यदि आपको ऑब्जेक्ट स्टोर का उपयोग करना है, या केवल ऑब्जेक्ट स्टोर को वहन कर सकता है, तो उत्तर एक FUSE फ़ाइल सिस्टम है। (https://github.com/libfuse/libfuse) । GCP पर, इसे gcsfuse कहा जाता है, और इसे स्थापित करने के लिए कदम हैं:

• अपने GCP Linux छवि पर gcsfuse स्थापित करें:
sudo apt अद्यतन
sudo apt स्थापित gcsfuse
GCP को प्रमाणित (अगर पहले से ही प्रमाणित नहीं है) :
सुनिश्चित करें कि आपके पास सही क्रेडेंशियल हैं, आम तौर पर सेवा खाते के माध्यम से या gcloud auth लॉगिन चलाकर।
• GCS बाल्टी को स्थानीय निर्देशिका में माउंट करें:
Gcsfuse का उपयोग करके अपने GCS बाल्टी को स्थानीय निर्देशिका में माउंट करें। यह आपके जीसीपी उदाहरण को डेटा तक पहुंचने की अनुमति देता है जैसे कि यह स्थानीय फ़ाइल सिस्टम का हिस्सा था।
Gcsfuse your-bucket-name /path/to/mount/directory

और अब आपके ऑब्जेक्ट स्टोर को एक्सेस किया जा सकता है जैसे कि यह लिनक्स फाइल सिस्टम का हिस्सा है, इसलिए इसके साथ काम करेगा। ERDDAP™ । यह जादू की तरह लगता है, दोनों दुनिया का सबसे अच्छा हो रहा है, वहाँ एक पकड़ होना चाहिए। और वहाँ है। फ्यूज़ फ़ाइल सिस्टम ऑब्जेक्ट स्टोर को सीधे एक्सेस करने की तुलना में एक अच्छा बिट धीमा है (मूल रूप से आपने एक्सेस में एक और परत जोड़ा है) । मेरे शोध अनुमानों में कितने धीमी गति से मानचित्र पर हैं, इसलिए मुझे कोई विचार नहीं है कि कितना धीमा है। लेकिन अगर आप एक ऐसी स्थिति में हैं जहां आपको ऑब्जेक्ट स्टोर का उपयोग करके जीसीपी पर चलना होगा, तो आपके पास अब एक समाधान है जो आपके साथ काम करेगा। ERDDAP™ ।

3. अब आप क्या कर सकते हैं?
---------------

यदि आपके पास इन चीजों में से कुछ का परीक्षण करने और अपने परिणामों पर वापस रिपोर्ट करने की क्षमता है, तो यह बहुत अच्छा होगा। विशेष रूप से अगर आपके पास GCP या इसी तरह की पहुंच है और देखें कि कितना धीमा है ERDDAP™ एक्सेस फ्यूज़ का उपयोग कर रहा है (वास्तव में आप यह भी AWS पर परीक्षण कर सकते हैं) । यदि स्पीड जुर्माना बहुत अच्छा नहीं है, तो यह अद्भुत होगा, क्योंकि मुझे विश्वास करने का कारण है कि कुछ लोगों को जल्द ही उनके पास जाना होगा। ERDDAP™ ऑब्जेक्ट स्टोर के साथ GCP पर S। इसलिए यह सिर्फ सैद्धांतिक हित की बात नहीं है।
